var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,r=(e,r)=>{for(var n in r||(r={}))i.call(r,n)&&l(e,n,r[n]);if(t)for(var n of t(r))s.call(r,n)&&l(e,n,r[n]);return e};import{V as n,d as a}from"./vendor.e9c367ae.js";import{d as o}from"./index.39efad9c.js";import{n as c,g as h}from"./index.2deacc07.js";import{H as m}from"./HTTPFileSystem.e57ad358.js";import{W as f}from"./NewXmlFetcher.worker.e9a3bf23.js";var u=n.component("tree-item",{props:{item:{type:Object,required:!0},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},data(){return{isOpen:this.expandAll,text:"",elementId:"",children:[],attributes:[]}},mounted(){const e=r({},this.item);this.attributes=this.getAttributes(e),delete e[":@"];const t=Object.keys(e);1!==t.length&&console.log("WHAT",t),this.elementId=t[0],this.children=e[t[0]]||[],1===this.children.length&&this.children[0]["#text"]&&(this.text=this.children[0]["#text"],this.children=[]),this.level<this.numberOfUnfoldLevel+1?this.isOpen=!0:this.isOpen=this.expandAll},methods:{getAttributes(e){const t=e[":@"];return t?Object.entries(t).map((e=>{const[t,i]=e;return[t.startsWith("$$")?t.substring(2):t,i]})):[]},toggle(){this.isOpen=!this.isOpen}},computed:{isFolder(){return this.children.length>0}}});const d={};var p=c(u,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",[i("div",{staticClass:"leaf-node",on:{click:e.toggle}},[i("div",{staticClass:"leaf-nav-title"},[e.children.length?i("div",{staticClass:"toggle"},[i("i",{staticClass:"fa",class:{"fa-plus-square":!e.isOpen,"fa-minus-square":e.isOpen},staticStyle:{"font-size":"0.7rem",margin:"5px 0 auto -8px"}})]):e._e(),i("b",{staticClass:"leaf-label"},[e._v(e._s(e.elementId))])]),e.text?i("div",{staticClass:"leaf-text"},[e._v("  "+e._s(e.text))]):e._e(),e._l(e.attributes,(function(t){return i("div",{staticClass:"leaf-attribute"},[i("span",[e._v("  "+e._s(t[0])+": ")]),i("b",[e._v('"'+e._s(t[1])+'"')])])}))],2),e.isFolder&&e.isOpen?i("ul",{staticClass:"children"},e._l(e.children,(function(t,s){return i("tree-item",{key:s,staticClass:"item",attrs:{item:t,root:!1,expandAll:e.expandAll,numberOfUnfoldLevel:e.numberOfUnfoldLevel,level:e.level+1},on:{navigate:function(t){return e.$emit("navigate",t)}}})})),1):e._e()])}),[],!1,v,"2d8c488c",null,null);function v(e){for(let t in d)this[t]=d[t]}var b=function(){return p.exports}(),g=n.component("tree-view",{props:{initialData:{},expandAll:{type:Boolean},level:{type:Number},numberOfUnfoldLevel:{type:Number}},components:{TreeItem:b},data:function(){return{treeData:this.initialData}},methods:{}});const x={};var y=c(g,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[i("tree-item",{staticClass:"item",attrs:{item:e.treeData||{},expandAll:e.expandAll,level:e.level+1,numberOfUnfoldLevel:e.numberOfUnfoldLevel}})],1)}),[],!1,O,null,null,null);function O(e){for(let t in x)this[t]=x[t]}var w=function(){return y.exports}();const L=!!!window.showDirectoryPicker,S=a({name:"XmlViewer",components:{TreeView:w},i18n:{messages:{en:{},de:{}}},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},config:{type:Object},resize:Object,thumbnail:Boolean,yamlConfig:String},data:()=>({globalState:h.state,vizDetails:{title:"",description:"",file:""},loadingText:"",id:`id-${Math.floor(1e12*Math.random())}`,xmlWorker:null,viewXml:{},fullXml:null,searchXml:null,searchTerm:"",debounceSearch:{},isLoaded:!1,isSearch:!1,numberOfUnfoldLevel:1}),watch:{searchTerm(){this.debounceSearch()}},computed:{fileApi(){return new m(this.fileSystem,h)},fileSystem(){const e=this.$store.state.svnProjects.filter((e=>e.slug===this.root));if(0===e.length)throw console.log("no such project"),Error;return e[0]}},async mounted(){this.debounceSearch=o(this.handleSearch,500);try{if(await this.getVizDetails(),this.thumbnail)return;const e=await this.fetchXml();this.fullXml=e[1],this.viewXml=this.fullXml,this.isLoaded=!0}catch(e){const t=e;console.error({e:t}),this.loadingText=""+t}this.numberOfUnfoldLevel=this.config.unfoldLevel+1},methods:{async getVizDetails(){var e;if(this.config)this.vizDetails=r({},this.config),this.vizDetails.file=`/${this.subfolder}/${this.config.file}`,this.$emit("title",this.vizDetails.title||this.vizDetails.file||"XML");else{const t=null!=(e=this.yamlConfig)?e:"";this.vizDetails={title:t,description:"",file:this.subfolder+"/"+t}}this.vizDetails.title||(this.vizDetails.title="XML"),this.$emit("title",this.vizDetails.title)},async fetchXml(){return this.loadingText=`Loading ${this.vizDetails.file}...`,this.xmlWorker&&this.xmlWorker.terminate(),this.xmlWorker=new f,new Promise(((e,t)=>{this.xmlWorker.onmessage=i=>{this.xmlWorker.terminate(),i.data.error&&t(i.data.error),e(i.data.xml)},this.xmlWorker.postMessage({id:1,fileSystem:this.fileSystem,filePath:this.vizDetails.file,options:{ignoreAttributes:!1,preserveOrder:!0,attributeNamePrefix:"$$",isFirefox:L}})}))},async handleSearch(){if(console.log("search:",this.searchTerm),this.searchTerm){const e=this.findSearchTermInElement([this.fullXml],this.searchTerm.toLocaleLowerCase());this.viewXml=e[0],this.isSearch=!0}else this.viewXml=this.fullXml,this.isSearch=!1;this.isLoaded=!1,await this.$nextTick(),this.isLoaded=!0},findSearchTermInElement(e,t){if(t!==this.searchTerm.toLocaleLowerCase())return[];const i=[];for(const s of e){const e=r({},s);if(e[":@"]){if(JSON.stringify(e[":@"]).toLocaleLowerCase().indexOf(t)>-1){i.push(s);continue}}if(e["#text"]){`${e["#text"]}`.toLocaleLowerCase().indexOf(t)>-1&&i.push(s);continue}const l=e[":@"];delete e[":@"];const n=Object.keys(e)[0],a=e[n];if(!a.length)continue;const o=this.findSearchTermInElement(a,t);if(o.length){const e={};l&&(e[":@"]=l),e[n]=o,i.push(e)}}return i}}});const T={};var C=c(S,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mycomponent",class:{"is-thumbnail":e.thumbnail}},[i("b-input",{staticClass:"searchbox",attrs:{type:"search","icon-pack":"fas",icon:"search",placeholder:"search..."},model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}}),i("div",{staticClass:"viewer"},[e.isLoaded?i("tree-view",{staticClass:"things",attrs:{initialData:e.viewXml,expandAll:e.isSearch,level:1,numberOfUnfoldLevel:e.numberOfUnfoldLevel}}):e._e()],1)],1)}),[],!1,_,"ca333fdc",null,null);function _(e){for(let t in T)this[t]=T[t]}var D=function(){return C.exports}();export{D as default};
//# sourceMappingURL=XmlViewer.42d8b3fb.js.map
