{"version":3,"file":"scatter.efcc4271.js","sources":["../../src/dash-panels/scatter.vue","../../src/dash-panels/scatter.vue?vue&type=template&lang.js"],"sourcesContent":["<template lang=\"pug\">\r\nVuePlotly.myplot(\r\n  :data=\"data\"\r\n  :layout=\"layout\"\r\n  :options=\"options\"\r\n  :id=\"id\"\r\n)\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\nimport type { PropType } from 'vue'\r\n\r\nimport DashboardDataManager, { FilterDefinition } from '@/js/DashboardDataManager'\r\nimport VuePlotly from '@/components/VuePlotly.vue'\r\nimport { FileSystemConfig, Status, BG_COLOR_DASHBOARD, UI_FONT } from '@/Globals'\r\nimport globalStore from '@/store'\r\nimport { buildCleanTitle } from './_allPanels'\r\n\r\nexport default defineComponent({\r\n  name: 'BarChartPanel',\r\n  components: { VuePlotly },\r\n  props: {\r\n    fileSystemConfig: { type: Object as PropType<FileSystemConfig>, required: true },\r\n    subfolder: { type: String, required: true },\r\n    files: { type: Array, required: true },\r\n    config: { type: Object as any, required: true },\r\n    cardTitle: { type: String, required: true },\r\n    cardId: String,\r\n    datamanager: { type: Object as PropType<DashboardDataManager>, required: true },\r\n  },\r\n  data: () => {\r\n    return {\r\n      globalState: globalStore.state,\r\n      // dataSet is either x,y or allRows[]\r\n      dataSet: {} as { x?: any[]; y?: any[]; allRows?: any },\r\n      id: ('scatter-' + Math.floor(1e12 * Math.random())) as any,\r\n      layout: {\r\n        height: 300,\r\n        margin: { t: 8, b: 0, l: 0, r: 0, pad: 2 },\r\n        font: {\r\n          color: '#444444',\r\n          family: UI_FONT,\r\n        },\r\n        xaxis: {\r\n          automargin: true,\r\n          autorange: true,\r\n          title: { text: '', standoff: 12 },\r\n          animate: true,\r\n        },\r\n        yaxis: {\r\n          automargin: true,\r\n          autorange: true,\r\n          title: { text: '', standoff: 16 },\r\n          animate: true,\r\n        },\r\n        legend: {\r\n          orientation: 'v',\r\n          x: 1,\r\n          y: 1,\r\n        },\r\n      },\r\n      data: [] as any[],\r\n      options: {\r\n        displaylogo: false,\r\n        responsive: true,\r\n        modeBarButtonsToRemove: [\r\n          'pan2d',\r\n          'zoom2d',\r\n          'select2d',\r\n          'lasso2d',\r\n          'zoomIn2d',\r\n          'zoomOut2d',\r\n          'autoScale2d',\r\n          'hoverClosestCartesian',\r\n          'hoverCompareCartesian',\r\n          'resetScale2d',\r\n          'toggleSpikelines',\r\n          'resetViewMapbox',\r\n        ],\r\n        toImageButtonOptions: {\r\n          format: 'png', // one of png, svg, jpeg, webp\r\n          filename: 'scatter-plot',\r\n          width: null,\r\n          height: null,\r\n        },\r\n      },\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.updateTheme()\r\n\r\n    this.options.toImageButtonOptions.filename = buildCleanTitle(this.cardTitle, this.subfolder)\r\n\r\n    this.dataSet = await this.loadData()\r\n    this.updateChart()\r\n\r\n    this.$emit('dimension-resizer', { id: this.cardId, resizer: this.changeDimensions })\r\n    this.$emit('isLoaded')\r\n  },\r\n  beforeDestroy() {\r\n    this.datamanager?.removeFilterListener(this.config, this.handleFilterChanged)\r\n  },\r\n\r\n  watch: {\r\n    'globalState.isDarkMode'() {\r\n      this.updateTheme()\r\n    },\r\n  },\r\n  methods: {\r\n    changeDimensions(dimensions: { width: number; height: number }) {\r\n      this.layout = Object.assign({}, this.layout, dimensions)\r\n    },\r\n\r\n    handleFilterChanged() {\r\n      if (!this.datamanager) return\r\n\r\n      const { filteredRows } = this.datamanager.getFilteredDataset(this.config) as any\r\n\r\n      if (!filteredRows || !filteredRows.length) {\r\n        this.dataSet = { allRows: {} }\r\n      } else {\r\n        const allRows = {} as any\r\n\r\n        const keys = Object.keys(filteredRows[0])\r\n        keys.forEach(key => (allRows[key] = { name: key, values: [] as any }))\r\n\r\n        filteredRows.forEach((row: any) => {\r\n          keys.forEach(key => allRows[key].values.push(row[key]))\r\n        })\r\n        this.dataSet = { allRows }\r\n      }\r\n\r\n      this.updateChart()\r\n    },\r\n\r\n    updateTheme() {\r\n      const colors = {\r\n        paper_bgcolor: BG_COLOR_DASHBOARD[this.globalState.colorScheme],\r\n        plot_bgcolor: BG_COLOR_DASHBOARD[this.globalState.colorScheme],\r\n        font: { color: this.globalState.isDarkMode ? '#cccccc' : '#444444' },\r\n      }\r\n      this.layout = Object.assign({}, this.layout, colors)\r\n    },\r\n\r\n    async loadData() {\r\n      try {\r\n        let dataset = await this.datamanager.getDataset(this.config)\r\n\r\n        // no filter? we are done\r\n        if (!this.config.filters) return dataset\r\n\r\n        // filter data before returning:\r\n        this.datamanager.addFilterListener(this.config, this.handleFilterChanged)\r\n\r\n        for (const [column, value] of Object.entries(this.config.filters)) {\r\n          const filter: FilterDefinition = {\r\n            dataset: this.config.dataset,\r\n            column: column,\r\n            value: value,\r\n            range: Array.isArray(value),\r\n          }\r\n          this.datamanager.setFilter(filter)\r\n        }\r\n        // empty for now; filtered data will come back later via handleFilterChanged async.\r\n        return { allRows: {} }\r\n      } catch (e) {\r\n        console.error('' + e)\r\n      }\r\n      return { allRows: {} }\r\n    },\r\n\r\n    updateChart() {\r\n      this.layout.xaxis.title.text = this.config.xAxisTitle || this.config.xAxisName || ''\r\n      this.layout.yaxis.title.text = this.config.yAxisTitle || this.config.yAxisName || ''\r\n\r\n      try {\r\n        if (this.config.groupBy) this.updateChartWithGroupBy()\r\n        else this.updateChartSimple()\r\n      } catch (e) {\r\n        const msg = '' + e\r\n        this.$store.commit('setStatus', {\r\n          type: Status.ERROR,\r\n          msg,\r\n          desc: 'Add a desription...',\r\n        })\r\n      }\r\n    },\r\n\r\n    updateChartWithGroupBy() {\r\n      // tba\r\n    },\r\n\r\n    // size circle\r\n    // color is data\r\n    updateChartSimple() {\r\n      var useOwnNames = false\r\n\r\n      const allRows = this.dataSet.allRows || ({} as any)\r\n      const columnNames = Object.keys(allRows)\r\n\r\n      if (!columnNames.length) return\r\n\r\n      const factor = this.config.factor || 1.0\r\n\r\n      // // old configs called it \"usedCol\" --> now \"columns\"\r\n      const columns = this.config.columns || this.config.usedCol || [this.config.y] || []\r\n\r\n      var legendname = columns\r\n      if (this.config.legendName) legendname = this.config.legendName\r\n      if (this.config.legendTitle) legendname = this.config.legendTitle\r\n\r\n      let x = allRows[this.config.x].values || []\r\n      if (this.config.skipFirstRow) x = x.slice(1)\r\n\r\n      const markerSize = this.config.markerSize || 3\r\n\r\n      for (let i = 0; i < columns.length; i++) {\r\n        const col = columns[i]\r\n        const legendName = useOwnNames ? this.config.legendTitles[i] : col\r\n\r\n        let values = allRows[col].values\r\n        if (this.config.skipFirstRow) values = values.slice(1)\r\n\r\n        this.data.push({\r\n          x: x,\r\n          y: values,\r\n          name: legendName,\r\n          mode: 'markers',\r\n          type: 'scatter',\r\n          textinfo: 'label+percent',\r\n          textposition: 'inside',\r\n          automargin: true,\r\n          showlegend: true,\r\n          marker: { size: markerSize },\r\n        })\r\n      }\r\n    },\r\n  },\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '@/styles.scss';\r\n\r\n.myplot {\r\n  position: absolute;\r\n  left: 0;\r\n  right: 0;\r\n  top: 0;\r\n  bottom: 0;\r\n}\r\n\r\n@media only screen and (max-width: 640px) {\r\n}\r\n</style>\r\n","\r\nVuePlotly.myplot(\r\n  :data=\"data\"\r\n  :layout=\"layout\"\r\n  :options=\"options\"\r\n  :id=\"id\"\r\n)\r\n"],"names":["__vue2_script","defineComponent","name","components","VuePlotly","props","fileSystemConfig","type","Object","required","subfolder","String","files","Array","config","cardTitle","cardId","datamanager","data","globalState","globalStore","state","dataSet","id","Math","floor","random","layout","height","margin","t","b","l","r","pad","font","color","family","UI_FONT","xaxis","automargin","autorange","title","text","standoff","animate","yaxis","legend","orientation","x","y","options","displaylogo","responsive","modeBarButtonsToRemove","toImageButtonOptions","format","filename","width","mounted","this","updateTheme","buildCleanTitle","loadData","updateChart","$emit","resizer","changeDimensions","beforeDestroy","_a","removeFilterListener","handleFilterChanged","watch","methods","dimensions","assign","filteredRows","getFilteredDataset","length","allRows","keys","forEach","key","values","row","push","colors","paper_bgcolor","BG_COLOR_DASHBOARD","colorScheme","plot_bgcolor","isDarkMode","dataset","getDataset","filters","addFilterListener","column","value","entries","filter","range","isArray","setFilter","e","console","error","xAxisTitle","xAxisName","yAxisTitle","yAxisName","groupBy","updateChartWithGroupBy","updateChartSimple","msg","$store","commit","Status","ERROR","desc","factor","columns","usedCol","legendName","legendTitle","skipFirstRow","slice","markerSize","i","col","mode","textinfo","textposition","showlegend","marker","size","_vm","_h","$createElement","_self","_c","staticClass","attrs"],"mappings":"qSAmBA,IAAAA,EAAAC,EAAA,CACAC,KAAA,gBACAC,WAAA,CAAAC,UAAAA,GACAC,MAAA,CACAC,iBAAA,CAAAC,KAAAC,OAAAC,UAAA,GACAC,UAAA,CAAAH,KAAAI,OAAAF,UAAA,GACAG,MAAA,CAAAL,KAAAM,MAAAJ,UAAA,GACAK,OAAA,CAAAP,KAAAC,OAAAC,UAAA,GACAM,UAAA,CAAAR,KAAAI,OAAAF,UAAA,GACAO,OAAAL,OACAM,YAAA,CAAAV,KAAAC,OAAAC,UAAA,IAEAS,KAAA,KACA,CACAC,YAAAC,EAAAC,MAEAC,QAAA,GACAC,GAAA,WAAAC,KAAAC,MAAA,KAAAD,KAAAE,UACAC,OAAA,CACAC,OAAA,IACAC,OAAA,CAAAC,EAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,IAAA,GACAC,KAAA,CACAC,MAAA,UACAC,OAAAC,GAEAC,MAAA,CACAC,YAAA,EACAC,WAAA,EACAC,MAAA,CAAAC,KAAA,GAAAC,SAAA,IACAC,SAAA,GAEAC,MAAA,CACAN,YAAA,EACAC,WAAA,EACAC,MAAA,CAAAC,KAAA,GAAAC,SAAA,IACAC,SAAA,GAEAE,OAAA,CACAC,YAAA,IACAC,EAAA,EACAC,EAAA,IAGAhC,KAAA,GACAiC,QAAA,CACAC,aAAA,EACAC,YAAA,EACAC,uBAAA,CACA,QACA,SACA,WACA,UACA,WACA,YACA,cACA,wBACA,wBACA,eACA,mBACA,mBAEAC,qBAAA,CACAC,OAAA,MACAC,SAAA,eACAC,MAAA,KACA9B,OAAA,SAAA+B,gBAMAC,KAAAC,cAEAD,KAAAT,QAAAI,qBAAAE,SAAAK,EAAAF,KAAA7C,UAAA6C,KAAAlD,WAEAkD,KAAAtC,cAAAsC,KAAAG,WACAH,KAAAI,cAEAJ,KAAAK,MAAA,oBAAA,CAAA1C,GAAAqC,KAAA5C,OAAAkD,QAAAN,KAAAO,mBACAP,KAAAK,MAAA,aAEAG,sBACA,OAAAC,EAAAT,KAAA3C,cAAAoD,EAAAC,qBAAAV,KAAA9C,OAAA8C,KAAAW,sBAGAC,MAAA,CACA,2BACAZ,KAAAC,gBAGAY,QAAA,CACAN,iBAAAO,GACAd,KAAAjC,OAAAnB,OAAAmE,OAAA,GAAAf,KAAAjC,OAAA+C,IAGAH,sBACA,IAAAX,KAAA3C,YAAA,OAEA,MAAA2D,aAAAA,GAAAhB,KAAA3C,YAAA4D,mBAAAjB,KAAA9C,QAEA,GAAA8D,GAAAA,EAAAE,OAEA,CACA,MAAAC,EAAA,GAEAC,EAAAxE,OAAAwE,KAAAJ,EAAA,IACAI,EAAAC,SAAAC,GAAAH,EAAAG,GAAA,CAAAhF,KAAAgF,EAAAC,OAAA,MAEAP,EAAAK,SAAAG,IACAJ,EAAAC,SAAAC,GAAAH,EAAAG,GAAAC,OAAAE,KAAAD,EAAAF,SAEAtB,KAAAtC,QAAA,CAAAyD,QAAAA,QAVAnB,KAAAtC,QAAA,CAAAyD,QAAA,IAaAnB,KAAAI,eAGAH,cACA,MAAAyB,EAAA,CACAC,cAAAC,EAAA5B,KAAAzC,YAAAsE,aACAC,aAAAF,EAAA5B,KAAAzC,YAAAsE,aACAtD,KAAA,CAAAC,MAAAwB,KAAAzC,YAAAwE,WAAA,UAAA,YAEA/B,KAAAjC,OAAAnB,OAAAmE,OAAA,GAAAf,KAAAjC,OAAA2D,IAAAvB,iBAIA,IACA,IAAA6B,QAAAhC,KAAA3C,YAAA4E,WAAAjC,KAAA9C,QAGA,IAAA8C,KAAA9C,OAAAgF,QAAA,OAAAF,EAGAhC,KAAA3C,YAAA8E,kBAAAnC,KAAA9C,OAAA8C,KAAAW,qBAEA,IAAA,MAAAyB,EAAAC,KAAAzF,OAAA0F,QAAAtC,KAAA9C,OAAAgF,SAAA,CACA,MAAAK,EAAA,CACAP,QAAAhC,KAAA9C,OAAA8E,QACAI,OAAAA,EACAC,MAAAA,EACAG,MAAAvF,MAAAwF,QAAAJ,IAEArC,KAAA3C,YAAAqF,UAAAH,GAGA,MAAA,CAAApB,QAAA,IAAA,MACAwB,GACAC,QAAAC,MAAA,GAAAF,GAEA,MAAA,CAAAxB,QAAA,KAGAf,cACAJ,KAAAjC,OAAAY,MAAAG,MAAAC,KAAAiB,KAAA9C,OAAA4F,YAAA9C,KAAA9C,OAAA6F,WAAA,GACA/C,KAAAjC,OAAAmB,MAAAJ,MAAAC,KAAAiB,KAAA9C,OAAA8F,YAAAhD,KAAA9C,OAAA+F,WAAA,GAEA,IACAjD,KAAA9C,OAAAgG,QAAAlD,KAAAmD,yBACAnD,KAAAoD,oBAAA,MACAT,GACA,MAAAU,EAAA,GAAAV,EACA3C,KAAAsD,OAAAC,OAAA,YAAA,CACA5G,KAAA6G,EAAAC,MACAJ,IAAAA,EACAK,KAAA,0BAKAP,2BAMAC,oBAGA,MAAAjC,EAAAnB,KAAAtC,QAAAyD,SAAA,GAGA,IAFAvE,OAAAwE,KAAAD,GAEAD,OAAA,OAEAlB,KAAA9C,OAAAyG,OAGA,MAAAC,EAAA5D,KAAA9C,OAAA0G,SAAA5D,KAAA9C,OAAA2G,SAAA,CAAA7D,KAAA9C,OAAAoC,GAGAU,KAAA9C,OAAA4G,YAAA9D,KAAA9C,OAAA4G,WACA9D,KAAA9C,OAAA6G,aAAA/D,KAAA9C,OAAA6G,YAEA,IAAA1E,EAAA8B,EAAAnB,KAAA9C,OAAAmC,GAAAkC,QAAA,GACAvB,KAAA9C,OAAA8G,eAAA3E,EAAAA,EAAA4E,MAAA,IAEA,MAAAC,EAAAlE,KAAA9C,OAAAgH,YAAA,EAEA,IAAA,IAAAC,EAAA,EAAAA,EAAAP,EAAA1C,OAAAiD,IAAA,CACA,MAAAC,EAAAR,EAAAO,GACAL,EAAAM,EAEA,IAAA7C,EAAAJ,EAAAiD,GAAA7C,OACAvB,KAAA9C,OAAA8G,eAAAzC,EAAAA,EAAA0C,MAAA,IAEAjE,KAAA1C,KAAAmE,KAAA,CACApC,EAAAA,EACAC,EAAAiC,EACAjF,KAAAwH,EACAO,KAAA,UACA1H,KAAA,UACA2H,SAAA,gBACAC,aAAA,SACA3F,YAAA,EACA4F,YAAA,EACAC,OAAA,CAAAC,KAAAR,gCC1Oa,WACX,IAAIS,EAAI3E,KACJ4E,EAAGD,EAAIE,eAGX,OAFOF,EAAIG,MAAMC,IAAIH,GAEX,YAAa,CACrBI,YAAa,SACbC,MAAO,CACL3H,KAAQqH,EAAIrH,KACZS,OAAU4G,EAAI5G,OACdwB,QAAWoF,EAAIpF,QACf5B,GAAMgH,EAAIhH,QAKM"}