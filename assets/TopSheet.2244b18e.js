import{d as e}from"./vendor.e9c367ae.js";import{g as t,n as s}from"./index.2deacc07.js";function l(){return new Worker("/simwrapper/assets/TopSheetWorker.worker.091394a9.js",{type:"module"})}var a=e({name:"TopSheet",props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},yaml:{type:String,required:!0},allConfigFiles:{type:Object,required:!0},cardId:String},data:()=>({globalState:t.state,solverThread:null,table:[],entries:[],title:""}),mounted(){this.files.length&&this.runTopSheet()},beforeDestroy(){try{this.solverThread&&(this.solverThread.terminate(),this.solverThread=null)}catch(e){console.warn(e)}},watch:{"globalState.locale"(){this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})}},methods:{formattedValue(e){return isNaN(e)?void 0===e?"-?-":e:e.toLocaleString([this.$store.state.locale,"en"])},async boxChanged(){console.log("changed!"),this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})},async runTopSheet(){if(this.files.length)try{this.solverThread||(console.log("spawning topsheet thread"),this.solverThread=new l,this.solverThread.onmessage=e=>{this.processWorkerMessage(e)}),this.solverThread.postMessage({command:"runTopSheet",fileSystemConfig:this.fileSystemConfig,subfolder:this.subfolder,files:this.files,yaml:this.yaml,locale:this.$store.state.locale,allConfigFiles:this.allConfigFiles})}catch(e){const t=""+e;console.log(t),this.table=[]}},processWorkerMessage(e){const t=e.data;switch(t.response){case"title":this.cardId?this.$emit("titles",t.title):this.title=t.title;break;case"entries":this.entries=t.entryFields;break;case"results":this.table=t.results,this.$emit("isLoaded");break;case"error":this.$store.commit("error",`${this.yaml}: ${t.message}`),this.$emit("isLoaded");break;default:this.$emit("isLoaded"),console.error(t)}}}});const i={};var r=s(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"topsheet curate-content"},[e.title?s("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.title))]):e._e(),e.entries.length?s("div",{staticClass:"output-table"},e._l(e.entries,(function(t,l){return s("div",{key:"entry"+l,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:t.style},[e._v(e._s(t.title))]),s("b-input",{staticClass:"b-input-tight cell top-value",style:t.style,on:{input:e.boxChanged},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"row.value"}})],1)})),0):e._e(),e.table.length?s("div",{staticClass:"output-table",staticStyle:{"margin-top":"1rem"}},e._l(e.table,(function(t,l){return s("div",{key:"row"+l,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:t.style},[e._v(e._s(t.title))]),s("div",{staticClass:"cell top-value",style:t.style},[e._v(e._s(e.formattedValue(t.value)))])])})),0):e._e()])}),[],!1,o,"5c6e7936",null,null);function o(e){for(let t in i)this[t]=i[t]}var n=function(){return r.exports}();export{n as T};
//# sourceMappingURL=TopSheet.2244b18e.js.map
