var t=Object.defineProperty,e=(e,n,o)=>(((e,n,o)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o})(e,"symbol"!=typeof n?n+"":n,o),o);import{j as n,V as o,r as a,R as i,f as s}from"./vendor.e9c367ae.js";import{c as r}from"./turf.es.943b3175.js";import{V as c}from"./VizConfigurator.a07eac42.js";import{Z as f}from"./ZoomButtons.e860a156.js";import{g as l,R as d,M as u,n as g}from"./index.2deacc07.js";import{W as h,D as b,S as p}from"./deckgl.61194435.js";import{G as m}from"./index.84f8ccb6.js";import{a as v,b as y,c as w,M as C,G as L,u as x}from"./layer.b20bd88e.js";import{p as F,a as S,b as M,r as O,c as I,d as E,e as _,t as D,f as T,u as A,g as P,h as z,i as k,j,k as N,A as R}from"./defaultLocale.439eab9b.js";import{r as B,c as G,d as U,a as $}from"./cubehelix.cc0b105a.js";import{b as Y,i as Z,e as V}from"./ColorsAndWidths.e99b2bfb.js";import{f as H,a as K,b as q}from"./defaultLocale.52699303.js";import{r as W,H as X}from"./HTTPFileSystem.e57ad358.js";import{m as J}from"./min.4e1438e9.js";import{r as Q,D as tt}from"./DashboardDataManager.e0d06cdd.js";import{C as et,S as nt,T as ot}from"./text-layer.f1b6c0de.js";import{b as at}from"./index.3d2ad359.js";import{u as it}from"./util.b5d45f97.js";function st(t,e){let n,o;if(void 0===e)for(const a of t)null!=a&&(void 0===n?a>=a&&(n=o=a):(n>a&&(n=a),o<a&&(o=a)));else{let a=-1;for(let i of t)null!=(i=e(i,++a,t))&&(void 0===n?i>=i&&(n=o=i):(n>i&&(n=i),o<i&&(o=i)))}return[n,o]}var rt=Math.sqrt(50),ct=Math.sqrt(10),ft=Math.sqrt(2);function lt(t,e,n){var o=(e-t)/Math.max(0,n),a=Math.floor(Math.log(o)/Math.LN10),i=o/Math.pow(10,a);return a>=0?(i>=rt?10:i>=ct?5:i>=ft?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=rt?10:i>=ct?5:i>=ft?2:1)}function dt(t){var e=t.length-1;return function(n){var o=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),a=t[o],i=t[o+1],s=o>0?t[o-1]:2*a-i,r=o<e-1?t[o+2]:2*i-a;return function(t,e,n,o,a){var i=t*t,s=i*t;return((1-3*t+3*i-s)*e+(4-6*i+3*s)*n+(1+3*t+3*i-3*s)*o+s*a)/6}((n-o/e)*e,s,a,i,r)}}var ut=t=>()=>t;function gt(t,e){return function(n){return t+n*e}}function ht(t){return 1==(t=+t)?bt:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(o){return Math.pow(t+o*e,n)}}(e,n,t):ut(isNaN(e)?n:e)}}function bt(t,e){var n=e-t;return n?gt(t,n):ut(isNaN(t)?e:t)}var pt=function t(e){var n=ht(e);function o(t,e){var o=n((t=B(t)).r,(e=B(e)).r),a=n(t.g,e.g),i=n(t.b,e.b),s=bt(t.opacity,e.opacity);return function(e){return t.r=o(e),t.g=a(e),t.b=i(e),t.opacity=s(e),t+""}}return o.gamma=t,o}(1);var mt,vt=(mt=dt,function(t){var e,n,o=t.length,a=new Array(o),i=new Array(o),s=new Array(o);for(e=0;e<o;++e)n=B(t[e]),a[e]=n.r||0,i[e]=n.g||0,s[e]=n.b||0;return a=mt(a),i=mt(i),s=mt(s),n.opacity=1,function(t){return n.r=a(t),n.g=i(t),n.b=s(t),n+""}});function yt(t,e){e||(e=[]);var n,o=t?Math.min(e.length,t.length):0,a=e.slice();return function(i){for(n=0;n<o;++n)a[n]=t[n]*(1-i)+e[n]*i;return a}}function wt(t,e){var n,o=e?e.length:0,a=t?Math.min(o,t.length):0,i=new Array(a),s=new Array(o);for(n=0;n<a;++n)i[n]=Ot(t[n],e[n]);for(;n<o;++n)s[n]=e[n];return function(t){for(n=0;n<a;++n)s[n]=i[n](t);return s}}function Ct(t,e){var n=new Date;return t=+t,e=+e,function(o){return n.setTime(t*(1-o)+e*o),n}}function Lt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function xt(t,e){var n,o={},a={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?o[n]=Ot(t[n],e[n]):a[n]=e[n];return function(t){for(n in o)a[n]=o[n](t);return a}}var Ft=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,St=new RegExp(Ft.source,"g");function Mt(t,e){var n,o,a,i=Ft.lastIndex=St.lastIndex=0,s=-1,r=[],c=[];for(t+="",e+="";(n=Ft.exec(t))&&(o=St.exec(e));)(a=o.index)>i&&(a=e.slice(i,a),r[s]?r[s]+=a:r[++s]=a),(n=n[0])===(o=o[0])?r[s]?r[s]+=o:r[++s]=o:(r[++s]=null,c.push({i:s,x:Lt(n,o)})),i=St.lastIndex;return i<e.length&&(a=e.slice(i),r[s]?r[s]+=a:r[++s]=a),r.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,o=0;o<e;++o)r[(n=c[o]).i]=n.x(t);return r.join("")})}function Ot(t,e){var n,o,a=typeof e;return null==e||"boolean"===a?ut(e):("number"===a?Lt:"string"===a?(n=G(e))?(e=n,pt):Mt:e instanceof G?pt:e instanceof Date?Ct:(o=e,!ArrayBuffer.isView(o)||o instanceof DataView?Array.isArray(e)?wt:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?xt:Lt:yt))(t,e)}function It(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Et(t){return function e(n){function o(e,o){var a=t((e=U(e)).h,(o=U(o)).h),i=bt(e.s,o.s),s=bt(e.l,o.l),r=bt(e.opacity,o.opacity);return function(t){return e.h=a(t),e.s=i(t),e.l=s(Math.pow(t,n)),e.opacity=r(t),e+""}}return n=+n,o.gamma=e,o}(1)}Et((function(t,e){var n=e-t;return n?gt(t,n>180||n<-180?n-360*Math.round(n/360):n):ut(isNaN(t)?e:t)}));var _t=Et(bt);function Dt(t){return+t}var Tt=[0,1];function At(t){return t}function Pt(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function zt(t,e,n){var o=t[0],a=t[1],i=e[0],s=e[1];return a<o?(o=Pt(a,o),i=n(s,i)):(o=Pt(o,a),i=n(i,s)),function(t){return i(o(t))}}function kt(t,e,n){var o=Math.min(t.length,e.length)-1,a=new Array(o),i=new Array(o),s=-1;for(t[o]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<o;)a[s]=Pt(t[s],t[s+1]),i[s]=n(e[s],e[s+1]);return function(e){var n=Y(t,e,1,o)-1;return i[n](a[n](e))}}function jt(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Nt(){var t,e,n,o,a,i,s=Tt,r=Tt,c=Ot,f=At;function l(){var t,e,n,c=Math.min(s.length,r.length);return f!==At&&(t=s[0],e=s[c-1],t>e&&(n=t,t=e,e=n),f=function(n){return Math.max(t,Math.min(e,n))}),o=c>2?kt:zt,a=i=null,d}function d(e){return null==e||isNaN(e=+e)?n:(a||(a=o(s.map(t),r,c)))(t(f(e)))}return d.invert=function(n){return f(e((i||(i=o(r,s.map(t),Lt)))(n)))},d.domain=function(t){return arguments.length?(s=Array.from(t,Dt),l()):s.slice()},d.range=function(t){return arguments.length?(r=Array.from(t),l()):r.slice()},d.rangeRound=function(t){return r=Array.from(t),c=It,l()},d.clamp=function(t){return arguments.length?(f=!!t||At,l()):f!==At},d.interpolate=function(t){return arguments.length?(c=t,l()):c},d.unknown=function(t){return arguments.length?(n=t,d):n},function(n,o){return t=n,e=o,l()}}function Rt(){return Nt()(At,At)}function Bt(t,e,n,o){var a,i=function(t,e,n){var o=Math.abs(e-t)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),i=o/a;return i>=rt?a*=10:i>=ct?a*=5:i>=ft&&(a*=2),e<t?-a:a}(t,e,n);switch((o=H(null==o?",f":o)).type){case"s":var s=Math.max(Math.abs(t),Math.abs(e));return null!=o.precision||isNaN(a=M(i,s))||(o.precision=a),K(o,s);case"":case"e":case"g":case"p":case"r":null!=o.precision||isNaN(a=S(i,Math.max(Math.abs(t),Math.abs(e))))||(o.precision=a-("e"===o.type));break;case"f":case"%":null!=o.precision||isNaN(a=F(i))||(o.precision=a-2*("%"===o.type))}return q(o)}function Gt(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var o,a,i,s,r=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((o=e<t)&&(a=t,t=e,e=a),0===(s=lt(t,e,n))||!isFinite(s))return[];if(s>0){let n=Math.round(t/s),o=Math.round(e/s);for(n*s<t&&++n,o*s>e&&--o,i=new Array(a=o-n+1);++r<a;)i[r]=(n+r)*s}else{s=-s;let n=Math.round(t*s),o=Math.round(e*s);for(n/s<t&&++n,o/s>e&&--o,i=new Array(a=o-n+1);++r<a;)i[r]=(n+r)/s}return o&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var o=e();return Bt(o[0],o[o.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var o,a,i=e(),s=0,r=i.length-1,c=i[s],f=i[r],l=10;for(f<c&&(a=c,c=f,f=a,a=s,s=r,r=a);l-- >0;){if((a=lt(c,f,n))===o)return i[s]=c,i[r]=f,e(i);if(a>0)c=Math.floor(c/a)*a,f=Math.ceil(f/a)*a;else{if(!(a<0))break;c=Math.ceil(c*a)/a,f=Math.floor(f*a)/a}o=a}return t},t}function Ut(){var t=Rt();return t.copy=function(){return jt(t,Ut())},Z.apply(t,arguments),Gt(t)}function $t(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Yt(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Zt(t){return t<0?-t*t:t*t}function Vt(t){var e=t(At,At),n=1;function o(){return 1===n?t(At,At):.5===n?t(Yt,Zt):t($t(n),$t(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,o()):n},Gt(e)}function Ht(){var t=Vt(Nt());return t.copy=function(){return jt(t,Ht()).exponent(t.exponent())},Z.apply(t,arguments),t}function Kt(){var t,e,n,o,a,i=0,s=1,r=At,c=!1;function f(e){return null==e||isNaN(e=+e)?a:r(0===n?.5:(e=(o(e)-t)*n,c?Math.max(0,Math.min(1,e)):e))}function l(t){return function(e){var n,o;return arguments.length?([n,o]=e,r=t(n,o),f):[r(0),r(1)]}}return f.domain=function(a){return arguments.length?([i,s]=a,t=o(i=+i),e=o(s=+s),n=t===e?0:1/(e-t),f):[i,s]},f.clamp=function(t){return arguments.length?(c=!!t,f):c},f.interpolator=function(t){return arguments.length?(r=t,f):r},f.range=l(Ot),f.rangeRound=l(It),f.unknown=function(t){return arguments.length?(a=t,f):a},function(a){return o=a,t=a(i),e=a(s),n=t===e?0:1/(e-t),f}}function qt(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Wt(){var t=Gt(Kt()(At));return t.copy=function(){return qt(t,Wt())},V.apply(t,arguments)}function Xt(){var t=Vt(Kt());return t.copy=function(){return qt(t,Xt()).exponent(t.exponent())},V.apply(t,arguments)}var Jt={exports:{}};!function(t,e,n){function o(t){var e,n=this,o=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var o=.02519603282416938*(e+=t.charCodeAt(n));o-=e=o>>>0,e=(o*=e)>>>0,e+=4294967296*(o-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=o(" "),n.s1=o(" "),n.s2=o(" "),n.s0-=o(t),n.s0<0&&(n.s0+=1),n.s1-=o(t),n.s1<0&&(n.s1+=1),n.s2-=o(t),n.s2<0&&(n.s2+=1),o=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var n=new o(t),i=e&&e.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.alea=i}(0,Jt);var Qt={exports:{}};!function(t,e,n){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var o=0;o<n.length+64;o++)e.x^=0|n.charCodeAt(o),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var n=new o(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.xor128=i}(0,Qt);var te={exports:{}};!function(t,e,n){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var o=0;o<n.length+64;o++)e.x^=0|n.charCodeAt(o),o==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var n=new o(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.xorwow=i}(0,te);var ee={exports:{}};!function(t,e,n){function o(t){var e=this;e.next=function(){var t,n,o=e.x,a=e.i;return t=o[a],n=(t^=t>>>7)^t<<24,n^=(t=o[a+1&7])^t>>>10,n^=(t=o[a+3&7])^t>>>3,n^=(t=o[a+4&7])^t<<7,t=o[a+7&7],n^=(t^=t<<13)^t<<9,o[a]=n,e.i=a+1&7,n},function(t,e){var n,o=[];if(e===(0|e))o[0]=e;else for(e=""+e,n=0;n<e.length;++n)o[7&n]=o[7&n]<<15^e.charCodeAt(n)+o[n+1&7]<<13;for(;o.length<8;)o.push(0);for(n=0;n<8&&0===o[n];++n);for(8==n?o[7]=-1:o[n],t.x=o,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var n=new o(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&(i.x&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.xorshift7=i}(0,ee);var ne={exports:{}};!function(t,e,n){function o(t){var e=this;e.next=function(){var t,n,o=e.w,a=e.X,i=e.i;return e.w=o=o+1640531527|0,n=a[i+34&127],t=a[i=i+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=a[i]=n^t,e.i=i,n+(o^o>>>16)|0},function(t,e){var n,o,a,i,s,r=[],c=128;for(e===(0|e)?(o=e,e=null):(e+="\0",o=0,c=Math.max(c,e.length)),a=0,i=-32;i<c;++i)e&&(o^=e.charCodeAt((i+32)%e.length)),0===i&&(s=o),o^=o<<10,o^=o>>>15,o^=o<<4,o^=o>>>13,i>=0&&(s=s+1640531527|0,a=0==(n=r[127&i]^=o+s)?a+1:0);for(a>=128&&(r[127&(e&&e.length||0)]=-1),a=127,i=512;i>0;--i)o=r[a+34&127],n=r[a=a+1&127],o^=o<<13,n^=n<<17,o^=o>>>15,n^=n>>>12,r[a]=o^n;t.w=s,t.X=r,t.i=a}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var n=new o(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&(i.X&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.xor4096=i}(0,ne);var oe={exports:{}};!function(t,e,n){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,o=e.d,a=e.a;return t=t<<25^t>>>7^n,n=n-o|0,o=o<<24^o>>>8^a,a=a-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-o|0,e.d=o<<16^n>>>16^a,e.a=a-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var o=0;o<n.length+20;o++)e.b^=0|n.charCodeAt(o),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var n=new o(t),i=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,i&&("object"==typeof i&&a(i,n),s.state=function(){return a(n,{})}),s}e&&e.exports?e.exports=i:this.tychei=i}(0,oe);var ae,ie={exports:{}};ae=ie,function(t,e,n){var o,a=256,i=n.pow(a,6),s=n.pow(2,52),r=2*s,c=255;function f(c,f,b){var p=[],m=g(u((f=1==f?{entropy:!0}:f||{}).entropy?[c,h(e)]:null==c?function(){try{var n;return o&&(n=o.randomBytes)?n=n(a):(n=new Uint8Array(a),(t.crypto||t.msCrypto).getRandomValues(n)),h(n)}catch(r){var i=t.navigator,s=i&&i.plugins;return[+new Date,t,s,t.screen,h(e)]}}():c,3),p),v=new l(p),y=function(){for(var t=v.g(6),e=i,n=0;t<s;)t=(t+n)*a,e*=a,n=v.g(1);for(;t>=r;)t/=2,e/=2,n>>>=1;return(t+n)/e};return y.int32=function(){return 0|v.g(4)},y.quick=function(){return v.g(4)/4294967296},y.double=y,g(h(v.S),e),(f.pass||b||function(t,e,o,a){return a&&(a.S&&d(a,v),t.state=function(){return d(v,{})}),o?(n.random=t,e):t})(y,m,"global"in f?f.global:this==n,f.state)}function l(t){var e,n=t.length,o=this,i=0,s=o.i=o.j=0,r=o.S=[];for(n||(t=[n++]);i<a;)r[i]=i++;for(i=0;i<a;i++)r[i]=r[s=c&s+t[i%n]+(e=r[i])],r[s]=e;(o.g=function(t){for(var e,n=0,i=o.i,s=o.j,r=o.S;t--;)e=r[i=c&i+1],n=n*a+r[c&(r[i]=r[s=c&s+e])+(r[s]=e)];return o.i=i,o.j=s,n})(a)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function u(t,e){var n,o=[],a=typeof t;if(e&&"object"==a)for(n in t)try{o.push(u(t[n],e-1))}catch(i){}return o.length?o:"string"==a?t:t+"\0"}function g(t,e){for(var n,o=t+"",a=0;a<o.length;)e[c&a]=c&(n^=19*e[c&a])+o.charCodeAt(a++);return h(e)}function h(t){return String.fromCharCode.apply(0,t)}if(g(n.random(),e),ae.exports){ae.exports=f;try{o=W}catch(b){}}else n.seedrandom=f}("undefined"!=typeof self?self:n,[],Math);var se=Jt.exports,re=Qt.exports,ce=te.exports,fe=ee.exports,le=ne.exports,de=oe.exports,ue=ie.exports;ue.alea=se,ue.xor128=re,ue.xorwow=ce,ue.xorshift7=fe,ue.xor4096=le,ue.tychei=de;var ge=ue;
/**
  * vue-class-component v7.2.6
  * (c) 2015-present Evan You
  * @license MIT
  */function he(t){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function be(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pe(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function me(){return"undefined"!=typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function ve(t,e){ye(t,e),Object.getOwnPropertyNames(e.prototype).forEach((function(n){ye(t.prototype,e.prototype,n)})),Object.getOwnPropertyNames(e).forEach((function(n){ye(t,e,n)}))}function ye(t,e,n){(n?Reflect.getOwnMetadataKeys(e,n):Reflect.getOwnMetadataKeys(e)).forEach((function(o){var a=n?Reflect.getOwnMetadata(o,e,n):Reflect.getOwnMetadata(o,e);n?Reflect.defineMetadata(o,a,t,n):Reflect.defineMetadata(o,a,t)}))}var we={__proto__:[]}instanceof Array;function Ce(t){return function(e,n,o){var a="function"==typeof e?e:e.constructor;a.__decorators__||(a.__decorators__=[]),"number"!=typeof o&&(o=void 0),a.__decorators__.push((function(e){return t(e,n,o)}))}}function Le(t,e){var n=e.prototype._init;e.prototype._init=function(){var e=this,n=Object.getOwnPropertyNames(t);if(t.$options.props)for(var o in t.$options.props)t.hasOwnProperty(o)||n.push(o);n.forEach((function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){t[n]=e},configurable:!0})}))};var o=new e;e.prototype._init=n;var a={};return Object.keys(o).forEach((function(t){void 0!==o[t]&&(a[t]=o[t])})),a}var xe=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function Fe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.name=e.name||t._componentTag||t.name;var n=t.prototype;Object.getOwnPropertyNames(n).forEach((function(t){if("constructor"!==t)if(xe.indexOf(t)>-1)e[t]=n[t];else{var o=Object.getOwnPropertyDescriptor(n,t);void 0!==o.value?"function"==typeof o.value?(e.methods||(e.methods={}))[t]=o.value:(e.mixins||(e.mixins=[])).push({data:function(){return be({},t,o.value)}}):(o.get||o.set)&&((e.computed||(e.computed={}))[t]={get:o.get,set:o.set})}})),(e.mixins||(e.mixins=[])).push({data:function(){return Le(this,t)}});var a=t.__decorators__;a&&(a.forEach((function(t){return t(e)})),delete t.__decorators__);var i=Object.getPrototypeOf(t.prototype),s=i instanceof o?i.constructor:o,r=s.extend(e);return Me(r,t,s),me()&&ve(r,t),r}var Se={prototype:!0,arguments:!0,callee:!0,caller:!0};function Me(t,e,n){Object.getOwnPropertyNames(e).forEach((function(o){if(!Se[o]){var a=Object.getOwnPropertyDescriptor(t,o);if(!a||a.configurable){var i,s,r=Object.getOwnPropertyDescriptor(e,o);if(!we){if("cid"===o)return;var c=Object.getOwnPropertyDescriptor(n,o);if(i=r.value,s=he(i),null!=i&&("object"===s||"function"===s)&&c&&c.value===r.value)return}Object.defineProperty(t,o,r)}}}))}function Oe(t){return"function"==typeof t?Fe(t):function(e){return Fe(e,t)}}Oe.registerHooks=function(t){xe.push.apply(xe,pe(t))};var Ie="undefined"!=typeof Reflect&&void 0!==Reflect.getMetadata;function Ee(t){return void 0===t&&(t={}),function(e,n){!function(t,e,n){if(Ie&&!Array.isArray(t)&&"function"!=typeof t&&!t.hasOwnProperty("type")&&void 0===t.type){var o=Reflect.getMetadata("design:type",e,n);o!==Object&&(t.type=o)}}(t,e,n),Ce((function(e,n){(e.props||(e.props={}))[n]=t}))(e,n)}}class _e extends v{constructor(t){super(t)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME animated-flow-lines-layer-vertex-shader\n#define SPEED 0.015\n#define NUM_PARTS 5.0\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instancePickable;\nattribute float instanceStaggering;\n\nuniform float opacity;\nuniform float currentTime;\nuniform float thicknessUnit;\n    \nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  // Position\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  float widthPixels = instanceWidths * thicknessUnit;\n  \n  \n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // extrude\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; \n}\n",fs:"#define SHADER_NAME animated-flow-lines-layer-fragment-shader\n\nprecision highp float;\n\nuniform float animationTailLength;\n\nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n                                   \nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - animationTailLength, 1.0, fract(sourceToTarget)));\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[y,w],shaderCache:this.context.shaderCache})}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:m.DOUBLE,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:m.DOUBLE,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:m.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}getNeedsRedraw(){return!0}updateState({props:t,oldProps:e,changeFlags:n}){var o;if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){const{gl:t}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{thicknessUnit:e,animationTailLength:n}=this.props,o=Date.now()/1e3%90/90*1800;this.state.model.setUniforms(Object.assign(Object.assign({},t),{thicknessUnit:4*e,animationTailLength:n,currentTime:o})).draw()}_getModel(t){return new C(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new L({drawMode:m.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))}}_e.defaultProps={currentTime:0,animationTailLength:.7,getSourcePosition:{type:"accessor",value:t=>[0,0]},getTargetPosition:{type:"accessor",value:t=>[0,0]},getPickable:{type:"accessor",value:t=>1},getStaggering:{type:"accessor",value:(t,{index:e})=>Math.random()},getColor:{type:"accessor",value:[0,132,193,255]},getThickness:{type:"accessor",value:1},thicknessUnit:30,parameters:{depthTest:!1}};const De=[1,0,0,1,2,-3,1,1,-3,1,0,0,1,1,-3,0,1,0,1,0,0,0,1,0,0,0,0];const Te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Ae extends v{constructor(t){super(t)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME flow-line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 instanceColors;\nattribute float instanceThickness;    // 0..0.5\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceEndpointOffsets;\nattribute float instancePickable;\n\nuniform vec4 outlineColor;\nuniform float thicknessUnit;\nuniform float gap;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n  \n  // Position\n  vec4 source_commonspace;    \n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  // linear interpolation of source & target to pick right coord\n  float sourceOrTarget = positions.x;\n  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // set the clamp limits in pixel size \n  float lengthCommon = length(target_commonspace - source_commonspace);    \n  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;\n  \n  vec2 limitedOffsetDistances = clamp(   \n    project_pixel_size(positions.yz) * thicknessUnit,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);\n  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    positions.x\n  );\n\n  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n  vec2 normalsCommon = project_pixel_size(normals.xy);\n  float gapCommon = project_pixel_size(gap);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n  \n  DECKGL_FILTER_SIZE(offsetCommon, geometry);\n  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  vec4 offset_commonspace = vec4(offsetCommon, 0.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);\n      \n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  \n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  if (vColor.a == 0.0) {\n    discard;\n  }\n\n  geometry.uv = uv;\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[y,w],shaderCache:this.context.shaderCache})}initializeState(){const{attributeManager:t}=this.state;t.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:m.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:m.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:m.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){const{gl:t}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(t)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{gl:e}=this.context,{outlineColor:n,thicknessUnit:o}=this.props;e.lineWidth(1),this.state.model.setUniforms(Object.assign(Object.assign({},t),{outlineColor:n.map((t=>t/255)),thicknessUnit:2*o,gap:.5})).draw()}_getModel(t){let e=[],n=[];const{drawOutline:o,outlineThickness:a}=this.props;if(o){e=e.concat(De);const t=a,o=1;n=n.concat(function(t,e){return[-e,2*t,1,2*t,-t,1,t,-t,1,-e,2*t,1,t,-t,1,t,-t,1,-e,2*t,1,t,-t,1,-e,-t,1]}(t,o))}return e=e.concat(De),n=n.concat(Te),new C(t,Object.assign(Object.assign({id:this.props.id},this.getShaders()),{geometry:new L({drawMode:m.TRIANGLES,attributes:{positions:new Float32Array(e),normals:new Float32Array(n)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}}Ae.layerName="FlowLinesLayer",Ae.defaultProps={getSourcePosition:{type:"accessor",value:t=>[0,0]},getTargetPosition:{type:"accessor",value:t=>[0,0]},getColor:{type:"accessor",value:[0,132,193,255]},getThickness:{type:"accessor",value:t=>t.count},getPickable:{type:"accessor",value:t=>1},drawOutline:!0,thicknessUnit:12,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}};const Pe=[0,0,0,255];class ze extends v{constructor(t){super(t)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME flow-circles-layer-vertex-shader\n#define radiusScale 100\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceInRadius;\nattribute float instanceOutRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec4 emptyColor;\nuniform float outlineEmptyMix;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float unitInRadius;\nvarying float unitOutRadius;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  float outerRadiusPixels = max(instanceInRadius, instanceOutRadius);\n  unitInRadius = instanceInRadius / outerRadiusPixels; \n  unitOutRadius = instanceOutRadius / outerRadiusPixels; \n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n                                                                                                    \n  // Find the center of the point and add the current vertex\n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n                            \n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-circles-layer-fragment-shader\n#define SOFT_OUTLINE 0.05\n#define EPS 0.05\nprecision highp float;\n\nuniform vec4 emptyColor;\nuniform float outlineEmptyMix;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float unitInRadius;\nvarying float unitOutRadius;\n\nfloat when_gt(float x, float y) {\n  return max(sign(x - y), 0.0);\n}\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n  float distToCenter = length(unitPosition);\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  // See https://stackoverflow.com/questions/47285778\n  vec4 ringColor = mix(\n    emptyColor / 255., vColor,\n    when_gt(unitInRadius, unitOutRadius)\n  );\n  vec4 outlineColor = mix(\n    mix(vColor, emptyColor / 255., outlineEmptyMix),\n    vColor,\n    when_gt(unitInRadius, unitOutRadius)\n  );\n  \n  float innerR = min(unitInRadius, unitOutRadius) * (1.0 - SOFT_OUTLINE);\n  \n  // Inner circle\n  float step2 = innerR - 2.0 * EPS; \n  float step3 = innerR - EPS;\n  \n  // Ring\n  float step4 = innerR;\n  // float step5 = 1.0 - SOFT_OUTLINE - EPS;\n  // float step6 = 1.0 - SOFT_OUTLINE;\n  float step5 = 1.0 - 5.0 * EPS;\n  float step6 = 1.0;\n  \n  gl_FragColor = vColor;\n  gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step2, step3, distToCenter));\n  gl_FragColor = mix(gl_FragColor, ringColor, smoothstep(step3, step4, distToCenter));\n  gl_FragColor = mix(gl_FragColor, outlineColor, smoothstep(step5, step6, distToCenter));\n  // gl_FragColor = mix(gl_FragColor, emptyColor / 255., smoothstep(step6, 1.0, distToCenter));\n  gl_FragColor.a = vColor.a;\n  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[y,w]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:m.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceInRadius:{size:1,transition:!0,accessor:"getInRadius",defaultValue:1},instanceOutRadius:{size:1,transition:!0,accessor:"getOutRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:m.UNSIGNED_BYTE,accessor:"getColor",defaultValue:Pe}})}updateState({props:t,oldProps:e,changeFlags:n}){if(super.updateState({props:t,oldProps:e,changeFlags:n}),n.extensionsChanged){const{gl:t}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(t)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{emptyColor:e,outlineEmptyMix:n}=this.props;this.state.model.setUniforms(Object.assign(Object.assign({},t),{emptyColor:e,outlineEmptyMix:n})).draw()}_getModel(t){return new C(t,Object.assign(this.getShaders(),{id:this.props.id,geometry:new L({drawMode:m.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0}))}}function ke(t){const{children:e}=t;return e&&e.length>0}function je(t){const{zoom:e}=t;return void 0!==e}function Ne(t){return t&&!!t.aggregate}var Re,Be;function Ge(t){for(var e=t.length/6|0,n=new Array(e),o=0;o<e;)n[o]="#"+t.slice(6*o,6*++o);return n}ze.layerName="FlowCirclesLayer",ze.defaultProps={getColor:{type:"accessor",value:Pe},emptyColor:{type:"accessor",value:[255,255,255,255]},outlineEmptyMix:{type:"accessor",value:.4},getPosition:{type:"accessor",value:t=>t.position},getInRadius:{type:"accessor",value:1},getOutRadius:{type:"accessor",value:1},parameters:{depthTest:!1}},(Be=Re||(Re={})).ALL="ALL",Be.INCOMING="INCOMING",Be.OUTGOING="OUTGOING",Be.BETWEEN="BETWEEN";var Ue=t=>vt(t[t.length-1]),$e=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(Ge);Ue($e);var Ye=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(Ge);Ue(Ye);var Ze=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(Ge);Ue(Ze);var Ve=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ge);Ue(Ve);var He=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(Ge);Ue(He);var Ke=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(Ge);Ue(Ke);var qe=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(Ge);Ue(qe);var We=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(Ge);Ue(We);var Xe=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ge);Ue(Xe);var Je=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ge);Ue(Je);var Qe=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(Ge);Ue(Qe);var tn=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ge);Ue(tn);var en=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ge);Ue(en);var nn=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ge);Ue(nn);var on=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(Ge);Ue(on);var an=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ge);Ue(an);var sn=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ge);Ue(sn);var rn=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ge);Ue(rn);var cn=_t(U(-100,.75,.35),U(80,1.5,.8)),fn=_t(U(260,.75,.35),U(80,1.5,.8));function ln(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}U();var dn=ln(Ge("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),un=ln(Ge("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),gn=ln(Ge("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),hn=ln(Ge("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const bn=["rgba(240,240,240,0.5)","#137CBD"],pn=["rgba(240,240,240,0.5)","#f6654e"],mn=["rgba(240,240,240,0.5)","#00a9cc"],vn=[255,255,255,255];function yn(t,e){const n=G(t);if(!n)return console.warn("Invalid color: ",t),`rgba(255, 255, 255, ${e})`;const o=n.rgb();return`rgba(${o.r}, ${o.g}, ${o.b}, ${e})`}function wn(t){if(Array.isArray(t))return t;const e=G(t);if(!e)return console.warn("Invalid color: ",t),vn;const n=e.rgb();return[Math.floor(n.r),Math.floor(n.g),Math.floor(n.b),(o=e.opacity,Math.round(255*o))];var o}function Cn(t,e){return t?wn(t):"string"==typeof e?wn(e):e}const Ln=t=>t[t.length-1];var xn;(xn||(xn={})).primary="#162d3c";const Fn=t=>O(0,21).map((e=>t(e/20))).reverse(),Sn=["rgba(240,240,240,0.5)",xn.primary],Mn=["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],On=Mn,In={Blues:Ln(en),BluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],BluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],BrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],BuGn:Ln($e),BuPu:Ln(Ye),Burg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],BurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],Cool:Fn(fn),DarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],Emrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],GnBu:Ln(Ze),Grayish:Sn,Greens:Ln(nn),Greys:Ln(on),Inferno:Fn(gn),Magenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],Magma:Fn(un),Mint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],Oranges:Ln(rn),OrRd:Ln(Ve),OrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],Peach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],Plasma:Fn(hn),PinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],PuBu:Ln(Ke),PuBuGn:Ln(He),PuRd:Ln(qe),Purp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],Purples:Ln(an),PurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],RdPu:Ln(We),RedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],Reds:Ln(sn),Sunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],SunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],Teal:Mn,TealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],Viridis:Fn(dn),Warm:Fn(cn),YlGn:Ln(Je),YlGnBu:Ln(Xe),YlOrBr:Ln(Qe),YlOrRd:Ln(tn)},En={negative:{flows:{scheme:["rgba(240,240,240,0.5)","#17a5be"]}},positive:{flows:{scheme:["rgba(240,240,240,0.5)","#f52020"]}},locationAreas:{outline:"rgba(92,112,128,0.5)",normal:"rgba(220,220,220,0.5)"},outlineColor:"rgb(230,233,237)"};function _n(t,e,n,o,a,i,s){if(t)return En;let r;Array.isArray(e)?r=e:(r=e&&In[e]||On,n&&(r=r.slice().reverse()));{const t=O(0,Math.max(10,r.length)),e=t.length-1,s=Wt(vt(r)).domain([0,e]);if(o&&0!==i){const o=Ht().exponent(1.5).domain([e,0]).range([0,2*i/100]);r=t.map(((t,e)=>{const i=s(e),r=o(e);if(null==i||null==r)return"#000";const c=$(i);return c.l=n?c.l-c.l*r:c.l+(100-c.l)*r,c.c=c.c-c.c*(r/4),a&&(c.opacity=c.opacity*(1-r)),c.toString()}))}else r=t.map(((t,e)=>s(e)))}return{darkMode:n,flows:{scheme:r},locationCircles:{outgoing:n?"#000":"#fff"},outlineColor:n?"#000":"rgba(255, 255, 255, 0.5)"}}function Dn(t,e,n){const o=Xt(function(t){const e=dt,n=t.length;let o,a,i=new Array(n),s=new Array(n),r=new Array(n),c=new Array(n);for(o=0;o<n;++o)a=B(t[o]),i[o]=a.r||0,s[o]=a.g||0,r[o]=a.b||0,c[o]=a.opacity||0;return i=e(i),s=e(s),r=e(r),c=e(c),function(t){return a.r=i(t),a.g=s(t),a.b=r(t),a.opacity=c(t),a+""}}(e)).exponent(n?.5:1/3).domain(t);return t=>wn(o(t))}function Tn(t){return void 0!==t.positive}function An(t,e){const n=t&&t.normal||"rgba(220,220,220,0.5)",o=$(n),a=wn(n);return{normal:a,connected:Cn(t&&t.connected,a),highlighted:Cn(t&&t.highlighted,yn(o[e?"brighter":"darker"](1).toString(),.5)),selected:Cn(t&&t.selected,yn(o[e?"brighter":"darker"](2).toString(),.8)),outline:Cn(t&&t.outline,wn(o[e?"brighter":"darker"](4).toString()))}}function Pn(t,e,n){var o,a,i;const s=t&&t.flows&&t.flows.scheme||e,r=$(s[s.length-1]),c=Cn(t&&t.flows&&t.flows.highlighted,wn(r[n?"brighter":"darker"](.7).toString())),f=Cn(null===(o=null==t?void 0:t.locationCircles)||void 0===o?void 0:o.empty,n?"#000":"#fff");return{flows:{scheme:s,highlighted:c},locationCircles:{inner:Cn(t&&t.locationCircles&&t.locationCircles.inner,r.toString()),outgoing:Cn(t&&t.locationCircles&&t.locationCircles.outgoing,n?"#000":"#fff"),incoming:Cn(t&&t.locationCircles&&t.locationCircles.incoming,r[n?"brighter":"darker"](1.25).toString()),highlighted:Cn(t&&t.locationCircles&&t.locationCircles.highlighted,c),empty:f,outlineEmptyMix:null!==(i=null===(a=null==t?void 0:t.locationCircles)||void 0===a?void 0:a.outlineEmptyMix)&&void 0!==i?i:.4}}}function zn(t){const e=!(!t||!t.darkMode);return{darkMode:e,locationAreas:An(t&&t.locationAreas,e),outlineColor:wn(t&&t.outlineColor||"#fff"),dimmedOpacity:t&&null!=t.dimmedOpacity?t.dimmedOpacity:.4}}function kn(t,e,n,o,a,i){if(a-o<=n)return;const s=o+a>>1;jn(t,e,s,o,a,i%2),kn(t,e,n,o,s-1,i+1),kn(t,e,n,s+1,a,i+1)}function jn(t,e,n,o,a,i){for(;a>o;){if(a-o>600){const s=a-o+1,r=n-o+1,c=Math.log(s),f=.5*Math.exp(2*c/3),l=.5*Math.sqrt(c*f*(s-f)/s)*(r-s/2<0?-1:1);jn(t,e,n,Math.max(o,Math.floor(n-r*f/s+l)),Math.min(a,Math.floor(n+(s-r)*f/s+l)),i)}const s=e[2*n+i];let r=o,c=a;for(Nn(t,e,o,n),e[2*a+i]>s&&Nn(t,e,o,a);r<c;){for(Nn(t,e,r,c),r++,c--;e[2*r+i]<s;)r++;for(;e[2*c+i]>s;)c--}e[2*o+i]===s?Nn(t,e,o,c):(c++,Nn(t,e,c,a)),c<=n&&(o=c+1),n<=c&&(a=c-1)}}function Nn(t,e,n,o){Rn(t,n,o),Rn(e,2*n,2*o),Rn(e,2*n+1,2*o+1)}function Rn(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}function Bn(t,e,n,o){const a=t-n,i=e-o;return a*a+i*i}const Gn=t=>t[0],Un=t=>t[1];class $n{constructor(t,e=Gn,n=Un,o=64,a=Float64Array){this.nodeSize=o,this.points=t;const i=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new i(t.length),r=this.coords=new a(2*t.length);for(let c=0;c<t.length;c++)s[c]=c,r[2*c]=e(t[c]),r[2*c+1]=n(t[c]);kn(s,r,o,0,s.length-1,0)}range(t,e,n,o){return function(t,e,n,o,a,i,s){const r=[0,t.length-1,0],c=[];let f,l;for(;r.length;){const d=r.pop(),u=r.pop(),g=r.pop();if(u-g<=s){for(let s=g;s<=u;s++)f=e[2*s],l=e[2*s+1],f>=n&&f<=a&&l>=o&&l<=i&&c.push(t[s]);continue}const h=Math.floor((g+u)/2);f=e[2*h],l=e[2*h+1],f>=n&&f<=a&&l>=o&&l<=i&&c.push(t[h]);const b=(d+1)%2;(0===d?n<=f:o<=l)&&(r.push(g),r.push(h-1),r.push(b)),(0===d?a>=f:i>=l)&&(r.push(h+1),r.push(u),r.push(b))}return c}(this.ids,this.coords,t,e,n,o,this.nodeSize)}within(t,e,n){return function(t,e,n,o,a,i){const s=[0,t.length-1,0],r=[],c=a*a;for(;s.length;){const f=s.pop(),l=s.pop(),d=s.pop();if(l-d<=i){for(let a=d;a<=l;a++)Bn(e[2*a],e[2*a+1],n,o)<=c&&r.push(t[a]);continue}const u=Math.floor((d+l)/2),g=e[2*u],h=e[2*u+1];Bn(g,h,n,o)<=c&&r.push(t[u]);const b=(f+1)%2;(0===f?n-a<=g:o-a<=h)&&(s.push(d),s.push(u-1),s.push(b)),(0===f?n+a>=g:o+a>=h)&&(s.push(u+1),s.push(l),s.push(b))}return r}(this.ids,this.coords,t,e,n,this.nodeSize)}}var Yn=function(t,e){return t===e};function Zn(t,e){var n,o,a="object"==typeof e?e:{equalityCheck:e},i=a.equalityCheck,s=void 0===i?Yn:i,r=a.maxSize,c=void 0===r?1:r,f=a.resultEqualityCheck,l=function(t){return function(e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var o=e.length,a=0;a<o;a++)if(!t(e[a],n[a]))return!1;return!0}}(s),d=1===c?(n=l,{get:function(t){return o&&n(o.key,t)?o.value:"NOT_FOUND"},put:function(t,e){o={key:t,value:e}},getEntries:function(){return o?[o]:[]},clear:function(){o=void 0}}):function(t,e){var n=[];function o(t){var o=n.findIndex((function(n){return e(t,n.key)}));if(o>-1){var a=n[o];return o>0&&(n.splice(o,1),n.unshift(a)),a.value}return"NOT_FOUND"}return{get:o,put:function(e,a){"NOT_FOUND"===o(e)&&(n.unshift({key:e,value:a}),n.length>t&&n.pop())},getEntries:function(){return n},clear:function(){n=[]}}}(c,l);function u(){var e=d.get(arguments);if("NOT_FOUND"===e){if(e=t.apply(null,arguments),f){var n=d.getEntries(),o=n.find((function(t){return f(t.value,e)}));o&&(e=o.value)}d.put(arguments,e)}return e}return u.clearCache=function(){return d.clear()},u}function Vn(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var n=e.map((function(t){return"function"==typeof t?"function "+(t.name||"unnamed")+"()":typeof t})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+n+"]")}return e}function Hn(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var a=function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];var i,s=0,r={memoizeOptions:void 0},c=o.pop();if("object"==typeof c&&(r=c,c=o.pop()),"function"!=typeof c)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof c+"]");var f=r,l=f.memoizeOptions,d=void 0===l?n:l,u=Array.isArray(d)?d:[d],g=Vn(o),h=t.apply(void 0,[function(){return s++,c.apply(null,arguments)}].concat(u)),b=t((function(){for(var t=[],e=g.length,n=0;n<e;n++)t.push(g[n].apply(null,arguments));return i=h.apply(null,t)}));return Object.assign(b,{resultFunc:c,memoizedResultFunc:h,dependencies:g,lastResult:function(){return i},recomputations:function(){return s},resetRecomputations:function(){return s=0}}),b};return a}var Kn=Hn(Zn);const qn={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(t,e)=>{},makeClusterId:t=>`{[${t}]}`};function Wn(t){const{index:e}=t;return null!=e}function Xn(t){const{id:e}=t;return null!=e}function Jn(t,e,n,o){const{getLocationLon:a,getLocationLat:i,getLocationId:s}=e,r=Object.assign(Object.assign({},qn),o),{minZoom:c,maxZoom:f,nodeSize:l,makeClusterName:d,makeClusterId:u}=r,g=new Array(f+1);let h=new Array,b=0;for(const F of t){const t=a(F),e=i(F);h.push({x:(p=t,p/360+.5),y:oo(e),weight:n(s(F)),zoom:1/0,index:b,parentId:-1,location:F}),b++}var p;g[f+1]=new $n(h,ao,io,l,Float32Array);let m=f+1;for(let F=f;F>=c;F--){const t=to(h,F,g[m],r);t.length===h.length?(g[F]=g[m],g[m]=void 0,m=F,h=t):(m=F,h=t,g[F]=new $n(h,ao,io,l,Float32Array))}if(0===g.length)return[];const v=g.map((t=>null==t?void 0:t.points.length)),y=J(v.filter((t=>t>0))),w=function(t,e){const{getLocationLon:n,getLocationLat:o}=e,a=new Map;let i=0;for(const r of t){const t=`${n(r)},${o(r)}`,e=a.get(t);a.set(t,e?e+1:1),i++}let s=0;for(const[r,c]of a)c>1&&s++;return i-s}(t,e);let C=v.indexOf(w);w<b&&(C++,C<f+1&&(g[C]=g[f+1],g[f+1]=void 0));const L=Math.min(C,v.lastIndexOf(y)),x=new Array;m=NaN;for(let F=C;F>=L;F--){let t;const e=g[F];if(!e)continue;F<C&&(t=Q(g[m].points,(t=>t.map((t=>t.id?u(t.id):s(t.location)))),(t=>t.parentId)));const n=[];for(const o of e.points){const{x:e,y:r,numPoints:c,location:f}=o;if(Wn(o))n.push({id:s(f),zoom:F,lat:i(f),lon:a(f)});else if(Xn(o)){const{id:a}=o,i=t&&t.get(a);if(!i)throw new Error(`Cluster ${a} doesn't have children`);n.push({id:u(a),name:d(a,c),zoom:F,lat:no(r),lon:eo(e),children:i})}}x.push({zoom:F,nodes:n}),m=F}return x}function Qn(t,e,n,o,a){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:o,weight:a}}function to(t,e,n,o){const a=[],{radius:i,extent:s}=o,r=i/(s*Math.pow(2,e));for(let c=0;c<t.length;c++){const o=t[c];if(o.zoom<=e)continue;o.zoom=e;const i=n.within(o.x,o.y,r);let s=o.weight||1,f=Xn(o)?o.numPoints:1,l=o.x*s,d=o.y*s;const u=(c<<5)+(e+1);for(const t of i){const o=n.points[t];if(o.zoom<=e)continue;o.zoom=e;const a=o.weight||1,i=o.numPoints||1;l+=o.x*a,d+=o.y*a,s+=a,f+=i,o.parentId=u}1===f?a.push(o):(o.parentId=u,a.push(Qn(l/s,d/s,u,f,s)))}return a}function eo(t){return 360*(t-.5)}function no(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function oo(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ao(t){return t.x}function io(t){return t.y}class so{constructor(t){this.getLocationId=t=>je(t)?t.id:this.accessors.getLocationId(t),this.getLocationName=t=>{let e;return je(t)&&ke(t)?e=t.name:this.accessors.getLocationName&&(e=this.accessors.getLocationName(t)),e||(e=`${this.getLocationId(t)}`),e},this.getLocationLat=t=>je(t)?t.lat:this.accessors.getLocationLat(t),this.getLocationLon=t=>je(t)?t.lon:this.accessors.getLocationLon(t),this.getFlowOriginId=t=>Ne(t)?t.origin:this.accessors.getFlowOriginId(t),this.getFlowDestId=t=>Ne(t)?t.dest:this.accessors.getFlowDestId(t),this.getFlowMagnitude=t=>Ne(t)?t.count:this.accessors.getFlowMagnitude(t),this.getFlowTime=t=>{const{getFlowTime:e}=this.accessors;return e?e(t):void 0},this.accessors=t}setAccessors(t){this.accessors=t}getFlowmapDataAccessors(){return this.accessors}}const ro=(t,e=0)=>{const n=e,o=new h(Object.assign(Object.assign({},t),{width:t.width+2*n,height:t.height+2*n})).getBounds();return[o[0][0],o[0][1],o[1][0],o[1][1]]},co=t=>{if(t)return Ut().range([.025,.5]).domain([0,Math.max.apply(null,t.map((t=>Math.abs(t||0))))])};var fo,lo;D("%Y-%m-%d"),D("%Y-%m-%d %H:%M"),D("%Y-%m-%d %H:%M:%S"),D("%Y"),D("%Y-%m"),(lo=fo||(fo={})).SECOND="SECOND",lo.MINUTE="MINUTE",lo.HOUR="HOUR",lo.DAY="DAY",lo.MONTH="MONTH",lo.YEAR="YEAR",T(".%L");const uo=T(":%S"),go=T("%I:%M"),ho=T("%I %p"),bo=T("%a %d");T("%b %d");const po=T("%b"),mo=T("%Y"),vo=[{order:0,key:fo.SECOND,interval:A,format:uo,formatFull:T("%Y-%m-%d %H:%M:%S")},{order:1,key:fo.MINUTE,interval:P,format:go,formatFull:T("%Y-%m-%d %H:%M")},{order:2,key:fo.HOUR,interval:z,format:ho,formatFull:T("%a %d %b %Y, %I %p")},{order:3,key:fo.DAY,interval:k,format:bo,formatFull:T("%a %d %b %Y")},{order:4,key:fo.MONTH,interval:j,format:po,formatFull:T("%b %Y")},{order:5,key:fo.YEAR,interval:N,format:mo,formatFull:T("%Y")}];function yo(t){return vo.find((e=>e.key===t))}class wo{constructor(t){this.getFlowsFromProps=(t,e)=>e.flows,this.getLocationsFromProps=(t,e)=>e.locations,this.getClusterLevelsFromProps=(t,e)=>e.clusterLevels,this.getMaxTopFlowsDisplayNum=(t,e)=>t.settings.maxTopFlowsDisplayNum,this.getSelectedLocations=(t,e)=>{var n;return null===(n=t.filter)||void 0===n?void 0:n.selectedLocations},this.getLocationFilterMode=(t,e)=>{var n;return null===(n=t.filter)||void 0===n?void 0:n.locationFilterMode},this.getClusteringEnabled=(t,e)=>t.settings.clusteringEnabled,this.getLocationTotalsEnabled=(t,e)=>t.settings.locationTotalsEnabled,this.getLocationLabelsEnabled=(t,e)=>t.settings.locationLabelsEnabled,this.getZoom=(t,e)=>t.viewport.zoom,this.getViewport=(t,e)=>t.viewport,this.getSelectedTimeRange=(t,e)=>{var n;return null===(n=t.filter)||void 0===n?void 0:n.selectedTimeRange},this.getColorScheme=(t,e)=>t.settings.colorScheme,this.getDarkMode=(t,e)=>t.settings.darkMode,this.getFadeEnabled=(t,e)=>t.settings.fadeEnabled,this.getFadeOpacityEnabled=(t,e)=>t.settings.fadeOpacityEnabled,this.getFadeAmount=(t,e)=>t.settings.fadeAmount,this.getAnimate=(t,e)=>t.settings.animationEnabled,this.getInvalidLocationIds=Kn(this.getLocationsFromProps,(t=>{if(!t)return;const e=[];for(const n of t){const t=this.accessors.getLocationId(n),o=this.accessors.getLocationLon(n),a=this.accessors.getLocationLat(n);-90<=a&&a<=90&&-180<=o&&o<=180||e.push(t)}return e.length>0?e:void 0})),this.getLocations=Kn(this.getLocationsFromProps,this.getInvalidLocationIds,((t,e)=>{if(!t)return;if(!e||0===e.length)return t;const n=new Set(e),o=[];for(const a of t){const t=this.accessors.getLocationId(a);n.has(t)||o.push(a)}return o})),this.getLocationIds=Kn(this.getLocations,(t=>{if(!t)return;const e=new Set;for(const n of t)e.add(this.accessors.getLocationId(n));return e})),this.getSelectedLocationsSet=Kn(this.getSelectedLocations,(t=>t&&t.length>0?new Set(t):void 0)),this.getSortedFlowsForKnownLocations=Kn(this.getFlowsFromProps,this.getLocationIds,((t,e)=>{if(!e||!t)return;const n=[];for(const o of t){const t=this.accessors.getFlowOriginId(o),a=this.accessors.getFlowDestId(o);e.has(t)&&e.has(a)&&n.push(o)}return n.sort(((t,e)=>_(Math.abs(this.accessors.getFlowMagnitude(t)),Math.abs(this.accessors.getFlowMagnitude(e)))))})),this.getActualTimeExtent=Kn(this.getSortedFlowsForKnownLocations,(t=>{if(!t)return;let e=null,n=null;for(const o of t){const t=this.accessors.getFlowTime(o);t&&((null==e||e>t)&&(e=t),(null==n||n<t)&&(n=t))}return e&&n?[e,n]:void 0})),this.getTimeGranularityKey=Kn(this.getSortedFlowsForKnownLocations,this.getActualTimeExtent,((t,e)=>{if(!t||!e)return;const n=J(t,(t=>{const e=this.accessors.getFlowTime(t);return e?function(t){let e;for(const n of vo){const{interval:o}=n;if(o(t)<t)return e||n;e=n}return vo[vo.length-1]}(e).order:null}));if(null==n)return;const o=(a=n,vo.find((t=>t.order===a)));var a;return o?o.key:void 0})),this.getTimeExtent=Kn(this.getActualTimeExtent,this.getTimeGranularityKey,((t,e)=>{const n=e?yo(e):void 0;if(!t||!(null==n?void 0:n.interval))return;const{interval:o}=n;return[t[0],o.offset(o.floor(t[1]),1)]})),this.getSortedFlowsForKnownLocationsFilteredByTime=Kn(this.getSortedFlowsForKnownLocations,this.getTimeExtent,this.getSelectedTimeRange,((t,e,n)=>{if(t)return!e||!n||e[0]===n[0]&&e[1]===n[1]?t:t.filter((t=>{const e=this.accessors.getFlowTime(t);return e&&n[0]<=e&&e<n[1]}))})),this.getLocationsHavingFlows=Kn(this.getSortedFlowsForKnownLocations,this.getLocations,((t,e)=>{if(!e||!t)return e;const n=new Set;for(const a of t)n.add(this.accessors.getFlowOriginId(a)),n.add(this.accessors.getFlowDestId(a));const o=[];for(const a of e)n.has(this.accessors.getLocationId(a))&&o.push(a);return o})),this.getLocationsById=Kn(this.getLocationsHavingFlows,(t=>{if(!t)return;const e=new Map;for(const n of t)e.set(this.accessors.getLocationId(n),n);return e})),this.getLocationWeightGetter=Kn(this.getSortedFlowsForKnownLocations,(t=>{if(!t)return;return function(t,{getFlowOriginId:e,getFlowDestId:n,getFlowMagnitude:o}){const a={incoming:new Map,outgoing:new Map};for(const i of t){const t=e(i),s=n(i),r=o(i);a.incoming.set(s,(a.incoming.get(s)||0)+r),a.outgoing.set(t,(a.outgoing.get(t)||0)+r)}return t=>Math.max(Math.abs(a.incoming.get(t)||0),Math.abs(a.outgoing.get(t)||0))}(t,this.accessors.getFlowmapDataAccessors())})),this.getClusterLevels=Kn(this.getClusterLevelsFromProps,this.getLocationsHavingFlows,this.getLocationWeightGetter,((t,e,n)=>{if(t)return t;if(!e||!n)return;return Jn(e,this.accessors.getFlowmapDataAccessors(),n,{maxZoom:20})})),this.getClusterIndex=Kn(this.getLocationsById,this.getLocationWeightGetter,this.getClusterLevels,((t,e,n)=>{if(!t||!e||!n)return;const o=function(t){const e=new Map,n=new Map,o=new Map;for(const{zoom:f,nodes:l}of t){e.set(f,l);for(const t of l)if(ke(t))n.set(t.id,t);else{const{id:e}=t,n=o.get(e);(null==n||n>f)&&o.set(e,f)}}const[a,i]=st(t,(t=>t.zoom));if(null==a||null==i)throw new Error("Could not determine minZoom or maxZoom");const s=new Map;for(const f of n.values()){const{zoom:t}=f;let e=s.get(t);e||(e=new Map,s.set(t,e)),r(f,(t=>{null==e||e.set(t,f)}))}function r(t,e){for(const o of t.children){const t=n.get(o);t?r(t,e):e(o)}}function c(t,e){const n=s.get(e);if(!n)return;const o=n.get(t);return o?o.id:void 0}return{availableZoomLevels:t.map((t=>+t.zoom)).sort(((t,e)=>I(t,e))),getClusterNodesFor:t=>{if(void 0!==t)return e.get(t)},getClusterById:t=>n.get(t),getMinZoomForLocation:t=>o.get(t)||a,expandCluster:(t,e=i)=>{const o=[],a=(t,o)=>{if(e>t.zoom)for(const e of t.children){const t=n.get(e);t?a(t,o):o.push(e)}else o.push(t.id)};return a(t,o),o},findClusterFor:c,aggregateFlows:(t,e,{getFlowOriginId:n,getFlowDestId:o,getFlowMagnitude:a},s={})=>{if(e>i)return t;const r=[],f=new Map,l=(t,e)=>`${t}:${e}`,{flowCountsMapReduce:d={map:a,reduce:(t,e)=>(t||0)+e}}=s;for(const i of t){const t=n(i),a=o(i),s=c(t,e)||t,u=c(a,e)||a,g=l(s,u);if(s===t&&u===a)r.push(i);else{let t=f.get(g);t?t.count=d.reduce(t.count,d.map(i)):(t={origin:s,dest:u,count:d.map(i),aggregate:!0},r.push(t),f.set(g,t))}}return r}}}(n);return function(t,e,n,o,a){const{getLocationId:i,getLocationName:s,getLocationClusterName:r}=o,c=t=>{const e=n.get(t);return e?s?s(e):i(e)||t:`"${t}"`};for(const f of e)for(const e of f.nodes)if(ke(e)){const n=t.expandCluster(e);if(n.sort(((t,e)=>_(a(t),a(e)))),r)e.name=r(n);else{const t=n[0],o=2===n.length?n[1]:void 0;e.name=`"${c(t)}" and ${o?`"${c(o)}"`:n.length-1+" others"}`}}else e.name=c(e.id)}(o,n,t,this.accessors.getFlowmapDataAccessors(),e),o})),this.getAvailableClusterZoomLevels=Kn(this.getClusterIndex,this.getSelectedLocations,((t,e)=>{if(!t)return;let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=e=>{const a=t.getClusterById(e);if(a)o=Math.max(o,a.zoom),n=Math.min(n,a.zoom);else{const n=t.getMinZoomForLocation(e);o=Math.max(o,n)}};if(e)for(const i of e)a(i);return t.availableZoomLevels.filter((t=>o<=t&&t<=n))})),this._getClusterZoom=Kn(this.getClusterIndex,this.getZoom,this.getAvailableClusterZoomLevels,((t,e,n)=>{if(!t)return;if(!n||null==e)return;return function(t,e){if(!t.length)throw new Error("No available zoom levels");return t[Math.min(E(t,Math.floor(e)),t.length-1)]}(n,e)})),this.getClusterZoom=(t,e)=>{const{settings:n}=t;if(n.clusteringEnabled)return n.clusteringAuto||null==n.clusteringLevel?this._getClusterZoom(t,e):n.clusteringLevel},this.getLocationsForSearchBox=Kn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getSelectedLocations,this.getClusterZoom,this.getClusterIndex,((t,e,n,o,a)=>{if(!e)return;let i=Array.from(e);if(a&&n){const t=[];for(const e of n){const n=a.getClusterById(e);n&&!i.find((t=>(je(t)?t.id:this.accessors.getLocationId(t))===e))&&t.push(n)}t.length>0&&(i=i.concat(t))}return i})),this.getDiffMode=Kn(this.getFlowsFromProps,(t=>{if(t)for(const e of t)if(this.accessors.getFlowMagnitude(e)<0)return!0;return!1})),this._getFlowmapColors=Kn(this.getDiffMode,this.getColorScheme,this.getDarkMode,this.getFadeEnabled,this.getFadeOpacityEnabled,this.getFadeAmount,this.getAnimate,_n),this.getFlowmapColorsRGBA=Kn(this._getFlowmapColors,(t=>void 0!==t.positive?function(t){const e=zn(t);return Object.assign(Object.assign({},e),{positive:Pn(t&&t.positive,pn,e.darkMode),negative:Pn(t&&t.negative,mn,e.darkMode)})}(t):function(t){const e=zn(t);return Object.assign(Object.assign({},e),Pn(t,bn,e.darkMode))}(t))),this.getUnknownLocations=Kn(this.getLocationIds,this.getFlowsFromProps,this.getSortedFlowsForKnownLocations,((t,e,n)=>{if(!t||!e)return;if(n)return;const o=new Set;for(const a of e)t.has(this.accessors.getFlowOriginId(a))||o.add(this.accessors.getFlowOriginId(a)),t.has(this.accessors.getFlowDestId(a))||o.add(this.accessors.getFlowDestId(a));return o})),this.getSortedAggregatedFilteredFlows=Kn(this.getClusterIndex,this.getClusteringEnabled,this.getSortedFlowsForKnownLocationsFilteredByTime,this.getClusterZoom,this.getTimeExtent,((t,e,n,o,a)=>{if(!n)return;let i;return i=e&&t&&null!=o?t.aggregateFlows(n,o,this.accessors.getFlowmapDataAccessors()):function(t,e){const n=Q(t,(t=>({aggregate:!0,origin:e.getFlowOriginId(t[0]),dest:e.getFlowDestId(t[0]),count:t.reduce(((t,n)=>{const o=e.getFlowMagnitude(n);return o&&!isNaN(o)&&isFinite(o)?t+o:t}),0)})),e.getFlowOriginId,e.getFlowDestId),o=[];for(const a of n.values())for(const t of a.values())o.push(t);return o}(n,this.accessors.getFlowmapDataAccessors()),i.sort(((t,e)=>_(Math.abs(this.accessors.getFlowMagnitude(t)),Math.abs(this.accessors.getFlowMagnitude(e))))),i})),this.getExpandedSelectedLocationsSet=Kn(this.getClusteringEnabled,this.getSelectedLocationsSet,this.getClusterIndex,((t,e,n)=>{if(!e||!n)return e;const o=new Set;for(const a of e){const t=n.getClusterById(a);if(t){const e=n.expandCluster(t);for(const t of e)o.add(t)}else o.add(a)}return o})),this.getTotalCountsByTime=Kn(this.getSortedFlowsForKnownLocations,this.getTimeGranularityKey,this.getTimeExtent,this.getExpandedSelectedLocationsSet,this.getLocationFilterMode,((t,e,n,o,a)=>{const i=e?yo(e):void 0;if(!t||!i||!n)return;const s=t.reduce(((t,e)=>{var n;if(this.isFlowInSelection(e,o,a)){const o=i.interval(this.accessors.getFlowTime(e)).getTime();t.set(o,(null!==(n=t.get(o))&&void 0!==n?n:0)+this.accessors.getFlowMagnitude(e))}return t}),new Map);return Array.from(s.entries()).map((([t,e])=>({time:new Date(t),count:e})))})),this.getMaxLocationCircleSize=Kn(this.getLocationTotalsEnabled,(t=>t?17:1)),this.getViewportBoundingBox=Kn(this.getViewport,this.getMaxLocationCircleSize,ro),this.getLocationsForZoom=Kn(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getClusterIndex,this.getClusterZoom,((t,e,n,o)=>t&&n?n.getClusterNodesFor(o):e)),this.getLocationTotals=Kn(this.getLocationsForZoom,this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,n,o)=>{if(!e)return;const a=new Map,i=(t,e)=>{var n;const o=null!==(n=a.get(t))&&void 0!==n?n:{incomingCount:0,outgoingCount:0,internalCount:0};return null!=e.incomingCount&&(o.incomingCount+=e.incomingCount),null!=e.outgoingCount&&(o.outgoingCount+=e.outgoingCount),null!=e.internalCount&&(o.internalCount+=e.internalCount),o};for(const s of e)if(this.isFlowInSelection(s,n,o)){const t=this.accessors.getFlowOriginId(s),e=this.accessors.getFlowDestId(s),n=this.accessors.getFlowMagnitude(s);t===e?a.set(t,i(t,{internalCount:n})):(a.set(t,i(t,{outgoingCount:n})),a.set(e,i(e,{incomingCount:n})))}return a})),this.getLocationsTree=Kn(this.getLocationsForZoom,(t=>{if(t)return new $n(t,(t=>Lo(this.accessors.getLocationLon(t))),(t=>xo(this.accessors.getLocationLat(t))))})),this._getLocationIdsInViewport=Kn(this.getLocationsTree,this.getViewportBoundingBox,((t,e)=>{const n=this._getLocationsInBboxIndices(t,e);if(n)return new Set(n.map((e=>t.points[e].id)))})),this.getLocationIdsInViewport=Hn(Zn,((t,e,n)=>{if(t===e)return!0;if(null==t||null==e)return!1;if(t.size!==e.size)return!1;for(const o of t)if(!e.has(o))return!1;return!0}))(this._getLocationIdsInViewport,(t=>{if(t)return t})),this.getTotalUnfilteredCount=Kn(this.getSortedFlowsForKnownLocations,(t=>{if(t)return t.reduce(((t,e)=>t+this.accessors.getFlowMagnitude(e)),0)})),this.getTotalFilteredCount=Kn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,n)=>{if(!t)return;return t.reduce(((t,o)=>this.isFlowInSelection(o,e,n)?t+this.accessors.getFlowMagnitude(o):t),0)})),this._getLocationTotalsExtent=Kn(this.getLocationTotals,(t=>Co(t,void 0))),this._getLocationTotalsForViewportExtent=Kn(this.getLocationTotals,this.getLocationIdsInViewport,((t,e)=>Co(t,e))),this.getLocationTotalsExtent=(t,e)=>t.settings.adaptiveScalesEnabled?this._getLocationTotalsForViewportExtent(t,e):this._getLocationTotalsExtent(t,e),this.getFlowsForFlowmapLayer=Kn(this.getSortedAggregatedFilteredFlows,this.getLocationIdsInViewport,this.getSelectedLocationsSet,this.getLocationFilterMode,this.getMaxTopFlowsDisplayNum,((t,e,n,o,a)=>{if(!t||!e)return;const i=[];let s=0;for(const r of t){const t=this.accessors.getFlowOriginId(r),c=this.accessors.getFlowDestId(r);if((e.has(t)||e.has(c))&&this.isFlowInSelection(r,n,o)&&t!==c&&(i.push(r),s++),s>a)break}return i.reverse()})),this._getFlowMagnitudeExtent=Kn(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,n)=>{if(!t)return;let o;for(const a of t)if(this.accessors.getFlowOriginId(a)!==this.accessors.getFlowDestId(a)&&this.isFlowInSelection(a,e,n)){const t=this.accessors.getFlowMagnitude(a);null==o?o=[t,t]:(t<o[0]&&(o[0]=t),t>o[1]&&(o[1]=t))}return o})),this._getAdaptiveFlowMagnitudeExtent=Kn(this.getFlowsForFlowmapLayer,(t=>{if(!t)return;const e=st(t,this.accessors.getFlowMagnitude);return void 0!==e[0]&&void 0!==e[1]?e:void 0})),this.getFlowMagnitudeExtent=(t,e)=>t.settings.adaptiveScalesEnabled?this._getAdaptiveFlowMagnitudeExtent(t,e):this._getFlowMagnitudeExtent(t,e),this.getLocationMaxAbsTotalGetter=Kn(this.getLocationTotals,(t=>e=>{const n=null==t?void 0:t.get(e);if(n)return Math.max(Math.abs(n.incomingCount+n.internalCount),Math.abs(n.outgoingCount+n.internalCount))})),this.getFlowThicknessScale=Kn(this.getFlowMagnitudeExtent,co),this.getCircleSizeScale=Kn(this.getMaxLocationCircleSize,this.getLocationTotalsEnabled,this.getLocationTotalsExtent,((t,e,n)=>e?n?function(){return Ht.apply(null,arguments).exponent(.5)}().range([0,t]).domain([0,Math.max.apply(null,n.map((t=>Math.abs(t||0))))]):void 0:()=>t)),this.getInCircleSizeGetter=Kn(this.getCircleSizeScale,this.getLocationTotals,((t,e)=>n=>{const o=null==e?void 0:e.get(n);return o&&t&&t(Math.abs(o.incomingCount+o.internalCount))||0})),this.getOutCircleSizeGetter=Kn(this.getCircleSizeScale,this.getLocationTotals,((t,e)=>n=>{const o=null==e?void 0:e.get(n);return o&&t&&t(Math.abs(o.outgoingCount+o.internalCount))||0})),this.getSortedLocationsForZoom=Kn(this.getLocationsForZoom,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,((t,e,n)=>{if(!t)return;return[...t].sort(((t,o)=>{const a=this.accessors.getLocationId(t),i=this.accessors.getLocationId(o);return I(Math.max(e(a),n(a)),Math.max(e(i),n(i)))}))})),this.getLocationsForFlowmapLayer=Kn(this.getSortedLocationsForZoom,(t=>t)),this.getLocationsForFlowmapLayerById=Kn(this.getLocationsForFlowmapLayer,(t=>{if(t)return t.reduce(((t,e)=>(t.set(this.accessors.getLocationId(e),e),t)),new Map)})),this.getLocationOrClusterByIdGetter=Kn(this.getClusterIndex,this.getLocationsById,((t,e)=>n=>{var o;return null!==(o=null==t?void 0:t.getClusterById(n))&&void 0!==o?o:null==e?void 0:e.get(n)})),this.getLayersData=Kn(this.getLocationsForFlowmapLayer,this.getFlowsForFlowmapLayer,this.getFlowmapColorsRGBA,this.getLocationsForFlowmapLayerById,this.getLocationIdsInViewport,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,this.getFlowThicknessScale,this.getAnimate,this.getLocationLabelsEnabled,((t,e,n,o,a,i,s,r,c,f)=>this._prepareLayersData(t,e,n,o,a,i,s,r,c,f))),this.accessors=new so(t),this.setAccessors(t)}setAccessors(t){this.accessors=new so(t)}getAggregateAccessors(){return this.accessors}prepareLayersData(t,e){const n=this.getLocationsForFlowmapLayer(t,e)||[],o=this.getFlowsForFlowmapLayer(t,e)||[],a=this.getFlowmapColorsRGBA(t,e),i=this.getLocationsForFlowmapLayerById(t,e),s=this.getLocationIdsInViewport(t,e),r=this.getInCircleSizeGetter(t,e),c=this.getOutCircleSizeGetter(t,e),f=this.getFlowThicknessScale(t,e),l=this.getLocationLabelsEnabled(t,e);return this._prepareLayersData(n,o,a,i,s,r,c,f,t.settings.animationEnabled,l)}_prepareLayersData(t,e,n,o,a,i,s,r,c,f){t||(t=[]),e||(e=[]);const{getFlowOriginId:l,getFlowDestId:d,getFlowMagnitude:u,getLocationId:g,getLocationLon:h,getLocationLat:b,getLocationName:p}=this.accessors,m=function(t,e,n){const o=e?e[0]:0,a=e?e[1]:0;if(Tn(t)){const e=Dn([0,a],t.positive.flows.scheme,n),i=Dn([0,o],t.negative.flows.scheme,n);return t=>t>=0?e(t):i(t)}const i=Dn([0,a||0],t.flows.scheme,n);return t=>i(t)}(n,st(e,(t=>u(t))),!1),v=Float32Array.from(function*(){for(const e of t)yield h(e),yield b(e)}()),y=Tn(n)?n.positive.locationCircles.inner:n.locationCircles.inner,w=Uint8Array.from(function*(){for(const e of t)yield*y}()),C=Float32Array.from(function*(){for(const e of t){const t=g(e);yield(null==a?void 0:a.has(t))?i(t):1}}()),L=Float32Array.from(function*(){for(const e of t){const t=g(e);yield(null==a?void 0:a.has(t))?s(t):1}}()),x=Float32Array.from(function*(){for(const t of e){const e=null==o?void 0:o.get(l(t));yield e?h(e):0,yield e?b(e):0}}()),F=Float32Array.from(function*(){for(const t of e){const e=null==o?void 0:o.get(d(t));yield e?h(e):0,yield e?b(e):0}}()),S=Float32Array.from(function*(){for(const t of e)yield r&&r(u(t))||0}()),M=Float32Array.from(function*(){for(const t of e){const e=l(t),n=d(t);yield Math.max(i(e),s(e)),yield Math.max(i(n),s(n))}}()),O=Uint8Array.from(function*(){for(const t of e)yield*m(u(t))}()),I=c?Float32Array.from(function*(){for(const t of e)yield new ge.alea(`${l(t)}-${d(t)}`)()}()):void 0;return Object.assign({circleAttributes:{length:t.length,attributes:{getPosition:{value:v,size:2},getColor:{value:w,size:4},getInRadius:{value:C,size:1},getOutRadius:{value:L,size:1}}},lineAttributes:{length:e.length,attributes:Object.assign({getSourcePosition:{value:x,size:2},getTargetPosition:{value:F,size:2},getThickness:{value:S,size:1},getColor:{value:O,size:4},getEndpointOffsets:{value:M,size:2}},I?{getStaggering:{value:I,size:1}}:{})}},f?{locationLabels:t.map(p)}:void 0)}getLocationsInBbox(t,e){if(t)return this._getLocationsInBboxIndices(t,e).map((e=>t.points[e]))}_getLocationsInBboxIndices(t,e){if(!t)return;const[n,o,a,i]=e,[s,r,c,f]=[Lo(n),xo(o),Lo(a),xo(i)];return t.range(Math.min(s,c),Math.min(r,f),Math.max(s,c),Math.max(r,f))}isFlowInSelection(t,e,n){const o=this.accessors.getFlowOriginId(t),a=this.accessors.getFlowDestId(t);if(e)switch(n){case Re.ALL:return e.has(o)||e.has(a);case Re.BETWEEN:return e.has(o)&&e.has(a);case Re.INCOMING:return e.has(a);case Re.OUTGOING:return e.has(o)}return!0}}function Co(t,e){if(!t)return;let n;for(const[o,{incomingCount:a,outgoingCount:i,internalCount:s}]of t.entries())if(null==e||e.has(o)){const t=Math.min(a+s,i+s,s),e=Math.max(a+s,i+s,s);n?(t<n[0]&&(n[0]=t),e>n[1]&&(n[1]=e)):n=[t,e]}return n}function Lo(t){return t/360+.5}function xo(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function Fo(t,e){const{getInRadius:n,getOutRadius:o}=t.attributes;return Math.max(n.value[e],o.value[e])}function So(t,e){const{getPosition:n}=t.attributes;return[n.value[2*e],n.value[2*e+1]]}var Mo=Math.PI,Oo=Mo/2,Io=Mo/4,Eo=2*Mo,_o=180/Mo,Do=Mo/180,To=Math.abs,Ao=Math.atan2,Po=Math.cos,zo=Math.sin,ko=Math.sqrt;function jo(){}function No(t,e){t&&Bo.hasOwnProperty(t.type)&&Bo[t.type](t,e)}var Ro={Feature:function(t,e){No(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,o=-1,a=n.length;++o<a;)No(n[o].geometry,e)}},Bo={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,o=-1,a=n.length;++o<a;)t=n[o],e.point(t[0],t[1],t[2])},LineString:function(t,e){Go(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,o=-1,a=n.length;++o<a;)Go(n[o],e,0)},Polygon:function(t,e){Uo(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,o=-1,a=n.length;++o<a;)Uo(n[o],e)},GeometryCollection:function(t,e){for(var n=t.geometries,o=-1,a=n.length;++o<a;)No(n[o],e)}};function Go(t,e,n){var o,a=-1,i=t.length-n;for(e.lineStart();++a<i;)o=t[a],e.point(o[0],o[1],o[2]);e.lineEnd()}function Uo(t,e){var n=-1,o=t.length;for(e.polygonStart();++n<o;)Go(t[n],e,1);e.polygonEnd()}var $o,Yo,Zo,Vo,Ho,Ko,qo,Wo,Xo,Jo,Qo,ta,ea,na,oa,aa,ia=new R,sa=new R,ra={point:jo,lineStart:jo,lineEnd:jo,polygonStart:function(){ia=new R,ra.lineStart=ca,ra.lineEnd=fa},polygonEnd:function(){var t=+ia;sa.add(t<0?Eo+t:t),this.lineStart=this.lineEnd=this.point=jo},sphere:function(){sa.add(Eo)}};function ca(){ra.point=la}function fa(){da($o,Yo)}function la(t,e){ra.point=da,$o=t,Yo=e,Zo=t*=Do,Vo=Po(e=(e*=Do)/2+Io),Ho=zo(e)}function da(t,e){var n=(t*=Do)-Zo,o=n>=0?1:-1,a=o*n,i=Po(e=(e*=Do)/2+Io),s=zo(e),r=Ho*s,c=Vo*i+r*Po(a),f=r*o*zo(a);ia.add(Ao(f,c)),Zo=t,Vo=i,Ho=s}function ua(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}var ga={point:ha,lineStart:pa,lineEnd:ma,polygonStart:function(){ga.point=va,ga.lineStart=ya,ga.lineEnd=wa,na=new R,ra.polygonStart()},polygonEnd:function(){ra.polygonEnd(),ga.point=ha,ga.lineStart=pa,ga.lineEnd=ma,ia<0?(Ko=-(Wo=180),qo=-(Xo=90)):na>1e-6?Xo=90:na<-1e-6&&(qo=-90),aa[0]=Ko,aa[1]=Wo},sphere:function(){Ko=-(Wo=180),qo=-(Xo=90)}};function ha(t,e){oa.push(aa=[Ko=t,Wo=t]),e<qo&&(qo=e),e>Xo&&(Xo=e)}function ba(t,e){var n,o,a,i,s=function(t){var e=t[0],n=t[1],o=Po(n);return[o*Po(e),o*zo(e),zo(n)]}([t*Do,e*Do]);if(ea){var r=ua(ea,s),c=ua([r[1],-r[0],0],r);i=ko((a=c)[0]*a[0]+a[1]*a[1]+a[2]*a[2]),a[0]/=i,a[1]/=i,a[2]/=i,c=[Ao((n=c)[1],n[0]),(o=n[2],o>1?Oo:o<-1?-Oo:Math.asin(o))];var f,l=t-Jo,d=l>0?1:-1,u=c[0]*_o*d,g=To(l)>180;g^(d*Jo<u&&u<d*t)?(f=c[1]*_o)>Xo&&(Xo=f):g^(d*Jo<(u=(u+360)%360-180)&&u<d*t)?(f=-c[1]*_o)<qo&&(qo=f):(e<qo&&(qo=e),e>Xo&&(Xo=e)),g?t<Jo?Ca(Ko,t)>Ca(Ko,Wo)&&(Wo=t):Ca(t,Wo)>Ca(Ko,Wo)&&(Ko=t):Wo>=Ko?(t<Ko&&(Ko=t),t>Wo&&(Wo=t)):t>Jo?Ca(Ko,t)>Ca(Ko,Wo)&&(Wo=t):Ca(t,Wo)>Ca(Ko,Wo)&&(Ko=t)}else oa.push(aa=[Ko=t,Wo=t]);e<qo&&(qo=e),e>Xo&&(Xo=e),ea=s,Jo=t}function pa(){ga.point=ba}function ma(){aa[0]=Ko,aa[1]=Wo,ga.point=ha,ea=null}function va(t,e){if(ea){var n=t-Jo;na.add(To(n)>180?n+(n>0?360:-360):n)}else Qo=t,ta=e;ra.point(t,e),ba(t,e)}function ya(){ra.lineStart()}function wa(){va(Qo,ta),ra.lineEnd(),To(na)>1e-6&&(Ko=-(Wo=180)),aa[0]=Ko,aa[1]=Wo,ea=null}function Ca(t,e){return(e-=t)<0?e+360:e}function La(t,e){return t[0]-e[0]}function xa(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function Fa(t){var e,n,o,a,i,s,r,c,f;if(Xo=Wo=-(Ko=qo=1/0),oa=[],f=ga,(c=t)&&Ro.hasOwnProperty(c.type)?Ro[c.type](c,f):No(c,f),n=oa.length){for(oa.sort(La),e=1,i=[o=oa[0]];e<n;++e)xa(o,(a=oa[e])[0])||xa(o,a[1])?(Ca(o[0],a[1])>Ca(o[0],o[1])&&(o[1]=a[1]),Ca(a[0],o[1])>Ca(o[0],o[1])&&(o[0]=a[0])):i.push(o=a);for(s=-1/0,e=0,o=i[n=i.length-1];e<=n;o=a,++e)a=i[e],(r=Ca(o[1],a[0]))>s&&(s=r,Ko=a[0],Wo=o[1])}return oa=aa=null,Ko===1/0||qo===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ko,qo],[Wo,Xo]]}function Sa(t,e,n,o){const a=t=>({type:"Point",coordinates:e(t)});let i;if(Array.isArray(t))i=t.map(a);else{i=[];for(const e of t)i.push(a(e))}return function(t,e,n){const{pad:o=.05,maxZoom:a=100}=n||{},i=Fa(t),[[s,r],[c,f]]=i,l=o?[[s-o*(c-s),r-o*(f-r)],[c+o*(c-s),f+o*(f-r)]]:i,[d,u]=e;return Object.assign(Object.assign({},x({width:d,height:u,bounds:l,padding:null==n?void 0:n.padding,maxZoom:a})),{width:d,height:u,bearing:0,pitch:0})}({type:"GeometryCollection",geometries:i},n,o)}var Ma,Oa,Ia=function(t,e,n,o){return new(n||(n=Promise))((function(a,i){function s(t){try{c(o.next(t))}catch(e){i(e)}}function r(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((o=o.apply(t,e||[])).next())}))};class Ea{constructor(t){this.selectors=new wo(t),this.flowmapData=void 0,this.flowmapState=void 0}setAccessors(t){this.selectors.setAccessors(t)}setFlowmapData(t){this.flowmapData=t}getSelectors(){return this.selectors}getFlowmapData(){return this.flowmapData}setFlowmapState(t){return Ia(this,void 0,void 0,(function*(){this.flowmapState=t}))}getFlowmapState(){return this.flowmapState}getFlowByIndex(t){return Ia(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData);return null==e?void 0:e[t]}))}getLocationByIndex(t){return Ia(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getLocationsForFlowmapLayer(this.flowmapState,this.flowmapData);return null==e?void 0:e[t]}))}getLayersData(){return Ia(this,void 0,void 0,(function*(){if(this.flowmapState&&this.flowmapData)return this.selectors.getLayersData(this.flowmapState,this.flowmapData)}))}getLocationById(t){return Ia(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getClusterIndex(this.flowmapState,this.flowmapData);if(e){const n=e.getClusterById(t);if(n)return n}const n=this.selectors.getLocationsById(this.flowmapState,this.flowmapData);return null==n?void 0:n.get(t)}))}getTotalsForLocation(t){var e;return Ia(this,void 0,void 0,(function*(){if(this.flowmapState&&this.flowmapData)return null===(e=this.selectors.getLocationTotals(this.flowmapState,this.flowmapData))||void 0===e?void 0:e.get(t)}))}getViewportForLocations(t,e){var n;return Ia(this,void 0,void 0,(function*(){if(null===(n=this.flowmapData)||void 0===n?void 0:n.locations)return Sa(this.flowmapData.locations,(t=>[this.selectors.accessors.getLocationLon(t),this.selectors.accessors.getLocationLat(t)]),t,e)}))}updateLayersData(t){return Ia(this,void 0,void 0,(function*(){t(yield this.getLayersData())}))}getClusterZoom(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterZoom(this.flowmapState,this.flowmapData):void 0}getClusterIndex(){return this.flowmapState&&this.flowmapData?this.selectors.getClusterIndex(this.flowmapState,this.flowmapData):void 0}getLocationsById(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationsById(this.flowmapState,this.flowmapData):void 0}getLocationTotals(){return this.flowmapState&&this.flowmapData?this.selectors.getLocationTotals(this.flowmapState,this.flowmapData):void 0}getFlowsForFlowmapLayer(){return this.flowmapState&&this.flowmapData?this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData):void 0}}(Oa=Ma||(Ma={})).LOCATION="location",Oa.FLOW="flow";var _a=function(t,e,n,o){return new(n||(n=Promise))((function(a,i){function s(t){try{c(o.next(t))}catch(e){i(e)}}function r(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,r)}c((o=o.apply(t,e||[])).next())}))};const Da=["filter","locationTotalsEnabled","locationLabelsEnabled","adaptiveScalesEnabled","animationEnabled","clusteringEnabled","clusteringLevel","fadeEnabled","fadeOpacityEnabled","clusteringAuto","darkMode","fadeAmount","colorScheme","highlightColor","maxTopFlowsDisplayNum"];var Ta,Aa;(Aa=Ta||(Ta={})).LOCATION="location",Aa.FLOW="flow";class Pa extends et{constructor(t){super(Object.assign(Object.assign({},t),{onHover:(e,n)=>{const o=Date.now();this.setState({highlightedObject:this._getHighlightedObject(e),lastHoverTime:o});const{onHover:a}=t;a&&this._getFlowmapLayerPickingInfo(e).then((t=>{var e,i;(null!==(i=null===(e=this.state)||void 0===e?void 0:e.lastHoverTime)&&void 0!==i?i:0)<=o&&(this.setState({pickingInfo:t}),a(t,n))}))},onClick:(e,n)=>{const{onClick:o}=t,a=Date.now();this.setState({lastClickTime:a}),o&&this._getFlowmapLayerPickingInfo(e).then((t=>{var e,i;(null!==(i=null===(e=this.state)||void 0===e?void 0:e.lastClickTime)&&void 0!==i?i:0)<=a&&(this.setState({pickingInfo:t}),t&&o(t,n))}))}}))}initializeState(){this.state={accessors:new so(this.props),dataProvider:this._getOrMakeDataProvider(),layersData:void 0,highlightedObject:void 0,pickingInfo:void 0,lastHoverTime:void 0,lastClickTime:void 0}}getPickingInfo({info:t}){var e,n;if(!t.object){const o=null===(n=null===(e=this.state)||void 0===e?void 0:e.pickingInfo)||void 0===n?void 0:n.object;if(o)return Object.assign(Object.assign({},t),{object:o,picked:!0})}return t}_getOrMakeDataProvider(){const{data:t,dataProvider:e}=this.props;if(function(t){return t&&"function"==typeof t.setFlowmapState&&"function"==typeof t.getViewportForLocations&&"function"==typeof t.getFlowByIndex&&"function"==typeof t.getLocationById&&"function"==typeof t.getLocationByIndex&&"function"==typeof t.getLayersData}(e))return e;if(function(t){return t&&t.locations&&t.flows}(t)){const e=new Ea(this.props);return e.setFlowmapData(t),e}throw new Error("FlowmapLayer: data must be a FlowmapDataProvider or FlowmapData")}_updateDataProvider(){this.setState({dataProvider:this._getOrMakeDataProvider()})}shouldUpdateState(t){const{changeFlags:e}=t;return!!e.viewportChanged||super.shouldUpdateState(t)}updateState({oldProps:t,props:e,changeFlags:n}){if(n.propsChanged,n.dataChanged&&this._updateDataProvider(),(n.viewportChanged||n.dataChanged)&&this.setState({highlightedObject:void 0}),n.viewportChanged||n.dataChanged||n.propsChanged&&Da.some((n=>t[n]!==e[n]))){const{dataProvider:t}=this.state||{};t&&(t.setFlowmapState(this._getFlowmapState()),t.updateLayersData((t=>{this.setState({layersData:t,highlightedObject:void 0})}),n))}}_getSettingsState(){const{locationTotalsEnabled:t,locationLabelsEnabled:e,adaptiveScalesEnabled:n,animationEnabled:o,clusteringEnabled:a,clusteringLevel:i,fadeEnabled:s,fadeOpacityEnabled:r,clusteringAuto:c,darkMode:f,fadeAmount:l,colorScheme:d,highlightColor:u,maxTopFlowsDisplayNum:g}=this.props;return{locationTotalsEnabled:t,locationLabelsEnabled:e,adaptiveScalesEnabled:n,animationEnabled:o,clusteringEnabled:a,clusteringLevel:i,fadeEnabled:s,fadeOpacityEnabled:r,clusteringAuto:c,darkMode:f,fadeAmount:l,colorScheme:d,highlightColor:u,maxTopFlowsDisplayNum:g}}_getFlowmapState(){return{viewport:za(this.context.viewport),filter:this.props.filter,settings:this._getSettingsState()}}_getFlowmapLayerPickingInfo(t){var e;return _a(this,void 0,void 0,(function*(){const{index:n,sourceLayer:o}=t,{dataProvider:a,accessors:i}=this.state||{};if(!a||!i)return;const s=Object.assign(Object.assign({},t),{picked:t.picked,layer:t.layer,index:t.index,x:t.x,y:t.y,coordinate:t.coordinate,event:t.event});if(o instanceof Ae||o instanceof _e){const t=-1===n?void 0:yield a.getFlowByIndex(n);if(t){const e=yield a.getLocationById(i.getFlowOriginId(t)),n=yield a.getLocationById(i.getFlowDestId(t));if(e&&n)return Object.assign(Object.assign({},s),{object:{type:Ma.FLOW,flow:t,origin:e,dest:n,count:i.getFlowMagnitude(t)}})}}else if(o instanceof ze){const o=-1===n?void 0:yield a.getLocationByIndex(n);if(o){const n=i.getLocationId(o),r=i.getLocationName(o),c=yield a.getTotalsForLocation(n),{circleAttributes:f}=(null===(e=this.state)||void 0===e?void 0:e.layersData)||{};if(c&&f){const e=Fo(f,t.index);return Object.assign(Object.assign({},s),{object:{type:Ma.LOCATION,location:o,id:n,name:r,totals:c,circleRadius:e}})}}}}))}_getHighlightedObject(t){var e,n;const{index:o,sourceLayer:a}=t;if(!(o<0))if(a instanceof Ae||a instanceof _e){const{lineAttributes:t}=(null===(e=this.state)||void 0===e?void 0:e.layersData)||{};if(t){let e=function(t,e){const{getColor:n,getEndpointOffsets:o,getSourcePosition:a,getTargetPosition:i,getThickness:s,getStaggering:r}=t.attributes;return{length:1,attributes:Object.assign({getColor:{value:n.value.subarray(4*e,4*(e+1)),size:4},getEndpointOffsets:{value:o.value.subarray(2*e,2*(e+1)),size:2},getSourcePosition:{value:a.value.subarray(2*e,2*(e+1)),size:2},getTargetPosition:{value:i.value.subarray(2*e,2*(e+1)),size:2},getThickness:{value:s.value.subarray(e,e+1),size:1}},r?{getStaggering:{value:r.value.subarray(e,e+1),size:1}}:void 0)}}(t,o);return this.props.fadeOpacityEnabled&&(e=Object.assign(Object.assign({},e),{attributes:Object.assign(Object.assign({},e.attributes),{getColor:Object.assign(Object.assign({},e.attributes.getColor),{value:new Uint8Array([...e.attributes.getColor.value.slice(0,3),255])})})})),{type:Ta.FLOW,lineAttributes:e}}}else if(a instanceof ze){const{circleAttributes:t}=(null===(n=this.state)||void 0===n?void 0:n.layersData)||{};if(t)return{type:Ta.LOCATION,coords:So(t,o),radius:Fo(t,o)}}}renderLayers(){var t;const e=[];if(null===(t=this.state)||void 0===t?void 0:t.layersData){const{layersData:t,highlightedObject:o}=this.state,{circleAttributes:a,lineAttributes:i,locationLabels:s}=t||{};if(a&&i){const t=wn(_n(!1,(n=this._getSettingsState()).colorScheme,n.darkMode,n.fadeEnabled,n.fadeOpacityEnabled,n.fadeAmount,n.animationEnabled).outlineColor||(this.props.darkMode?"#000":"#fff")),s={data:i,parameters:Object.assign(Object.assign({},this.props.parameters),{depthTest:!1})};if(this.props.animationEnabled?e.push(new _e(Object.assign({},this.getSubLayerProps(Object.assign(Object.assign({},s),{id:"animated-flow-lines",drawOutline:!1,thicknessUnit:20}))))):e.push(new Ae(Object.assign({},this.getSubLayerProps(Object.assign(Object.assign({},s),{id:"flow-lines",drawOutline:!0,outlineColor:t}))))),e.push(new ze(this.getSubLayerProps({id:"circles",data:a,emptyColor:this.props.darkMode?[0,0,0,255]:[255,255,255,255],outlineEmptyMix:.4}))),o)switch(o.type){case Ta.LOCATION:e.push(new nt(Object.assign({},this.getSubLayerProps({id:"location-highlight",data:[o],pickable:!1,antialiasing:!0,stroked:!0,filled:!1,lineWidthUnits:"pixels",getLineWidth:2,radiusUnits:"pixels",getRadius:t=>t.radius,getLineColor:wn(this.props.highlightColor),getPosition:t=>t.coords}))));break;case Ta.FLOW:e.push(new Ae(Object.assign({},this.getSubLayerProps({id:"flow-highlight",data:o.lineAttributes,drawOutline:!0,pickable:!1,outlineColor:wn(this.props.highlightColor),outlineThickness:1,parameters:{depthTest:!1}}))))}}s&&e.push(new ot(this.getSubLayerProps({id:"location-labels",data:s,maxWidth:1e3,pickable:!1,fontFamily:"Helvetica",getPixelOffset:(t,{index:e})=>[0,Fo(a,e)+5],getPosition:(t,{index:e})=>So(a,e),getText:t=>t,getSize:10,getColor:[255,255,255,255],getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"top"})))}var n;return e}}function za(t){const{width:e,height:n,longitude:o,latitude:a,zoom:i,pitch:s,bearing:r}=t;return{width:e,height:n,longitude:o,latitude:a,zoom:i,pitch:s,bearing:r}}Pa.defaultProps={darkMode:!0,fadeAmount:50,locationTotalsEnabled:!0,locationLabelsEnabled:!1,animationEnabled:!1,clusteringEnabled:!0,fadeEnabled:!0,fadeOpacityEnabled:!1,clusteringAuto:!0,clusteringLevel:void 0,adaptiveScalesEnabled:!0,colorScheme:"Teal",highlightColor:"orange",maxTopFlowsDisplayNum:5e3};var ka=Object.defineProperty,ja=Object.getOwnPropertyDescriptor,Na=(t,e,n,o)=>{for(var a,i=o>1?void 0:o?ja(e,n):e,s=t.length-1;s>=0;s--)(a=t[s])&&(i=(o?a(e,n,i):a(i))||i);return o&&i&&ka(e,n,i),i};o.use(s);let Ra=class extends o{constructor(){super(...arguments),e(this,"fsConfig"),e(this,"root"),e(this,"configFromDashboard"),e(this,"thumbnail"),e(this,"subfolder"),e(this,"files"),e(this,"yamlConfig"),e(this,"datamanager"),e(this,"boundaries",[]),e(this,"fileApi"),e(this,"fileSystemConfig"),e(this,"centroids",[]),e(this,"flows",[]),e(this,"viewId",Math.floor(1e12*Math.random())),e(this,"statusText","Loading..."),e(this,"needsInitialMapExtent",!0),e(this,"vizDetails",{title:"",description:"",thumbnail:"",zoom:9,center:null,pitch:0,bearing:0,boundaries:"",boundariesJoinCol:"",boundariesLabels:"",boundariesLabel:"",dataset:"",origin:"",destination:"",flow:"",colorScheme:"Teal",highlightColor:"orange",fadeEnabled:!0,fadeAmount:50,animationEnabled:!0,clustering:!0,clusteringLevel:null,locationLabelsEnabled:!0,locationTotalsEnabled:!0,pickable:!0,opacity:null,fadeOpacityEnabled:!0,outlineThickness:0,showOnlyTopFlows:null,maxTopFlowsDisplayNum:null}),e(this,"myState",{statusMessage:"",fileApi:void 0,fileSystem:void 0,subfolder:"",yamlConfig:"",thumbnail:!1}),e(this,"myDataManager"),e(this,"startTime",Date.now()),e(this,"elapsed",0),e(this,"animator",null),e(this,"thumbnailUrl","url('assets/thumbnail.jpg') no-repeat;")}get mapProps(){return{locations:this.centroids,flows:this.flows,dark:this.$store.state.isDarkMode,elapsed:this.elapsed,vizDetails:this.vizDetails}}viewMoved(){d[this.viewId]&&d[this.viewId]()}async mounted(){try{if(this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig,this.buildFileApi(),this.myDataManager=this.datamanager||new tt(this.root,this.subfolder),await this.getVizDetails(),this.thumbnail)return void this.buildThumbnail();this.needsInitialMapExtent&&(this.vizDetails.center||this.vizDetails.zoom)&&(this.$store.commit("setMapCamera",{center:this.vizDetails.center,zoom:this.vizDetails.zoom||9,bearing:this.vizDetails.bearing||0,pitch:this.vizDetails.pitch||0,longitude:this.vizDetails.center?this.vizDetails.center[0]:0,latitude:this.vizDetails.center?this.vizDetails.center[1]:0}),this.needsInitialMapExtent=!1),await this.loadBoundaries(),await this.loadDataset(),this.updateChart(),this.$emit("isLoaded"),this.vizDetails=Object.assign({},this.vizDetails),this.statusText=""}catch(t){this.$store.commit("error","Flowmap"+t)}}beforeDestroy(){this.animator&&window.cancelAnimationFrame(this.animator),delete d[this.viewId]}buildFileApi(){const t=this.fsConfig||this.getFileSystem(this.root);this.fileApi=new X(t,l),this.fileSystemConfig=t}get urlThumbnail(){return this.thumbnailUrl}async getVizDetails(){if(this.configFromDashboard)return console.log("we have a dashboard"),this.validateYAML(),void(this.vizDetails=Object.assign({},this.configFromDashboard));new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)&&(console.log("has yaml"),await this.loadStandaloneYAMLConfig())}async buildThumbnail(){if(this.myState.fileApi&&this.thumbnail&&this.vizDetails.thumbnail)try{const t=await this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),e=await t.arrayBuffer(),n=it.arrayBufferToBase64(e);n&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${n})`)}catch(t){console.error(t)}}async validateYAML(){}async loadStandaloneYAMLConfig(){if(!this.fileApi)return{};const t=this.yamlConfig.indexOf("/")>-1?this.yamlConfig:this.subfolder+"/"+this.yamlConfig;try{const e=await this.fileApi.getFileText(t);return void(this.vizDetails=Object.assign({},at.parse(e)))}catch(n){const e=""+n;e.startsWith("YAMLSemantic")&&this.$store.commit("error",`${t}: ${e}`),console.log(`${t} not found, trying config folders`)}const{vizes:e}=await this.fileApi.findAllYamlConfigs(this.subfolder);if(e[this.yamlConfig])try{const t=await this.fileApi.getFileText(e[this.yamlConfig]);this.vizDetails=Object.assign({},at.parse(t))}catch(n){console.error(`Also failed to load ${e[this.yamlConfig]}`)}}async loadBoundaries(){try{if(this.vizDetails.boundaries.startsWith("http")){console.log("in http");const t=await fetch(this.vizDetails.boundaries).then((async t=>await t.json()));this.boundaries=t.features}else{this.subfolder,this.vizDetails.boundaries;const t=await this.fileApi.getFileJson(`${this.subfolder}/${this.vizDetails.boundaries}`);this.boundaries=t.features}}catch(t){return void console.error(t)}this.calculateCentroids(),this.setMapCenter()}calculateCentroids(){const t=this.vizDetails.boundariesLabels||this.vizDetails.boundariesLabel;for(const e of this.boundaries){const n=r(e);e.properties[t]&&(n.properties.label=e.properties[t]),n.properties.id=""+e.properties[this.vizDetails.boundariesJoinCol],this.centroids.push({id:`${n.properties.id}`,lon:n.geometry.coordinates[0],lat:n.geometry.coordinates[1]})}console.log({centroids:this.centroids})}async setMapCenter(){if(this.vizDetails.center)return"string"==typeof this.vizDetails.center&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number)),void this.$store.commit("setMapCamera",{longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],bearing:0,pitch:0,zoom:this.vizDetails.zoom||10,jump:!1});if(!this.centroids.length)return;let t=0,e=0,n=0;const o=this.centroids.length;for(let i=0;i<o;i+=256)e+=this.centroids[i].lon,n+=this.centroids[i].lat,t++;e/=t,n/=t;const a=this.$store.state.viewState;e&&n&&this.$store.commit("setMapCamera",{longitude:e,latitude:n,bearing:a.bearing,pitch:a.pitch,zoom:this.vizDetails.zoom||a.zoom,jump:!1})}getFileSystem(t){const e=this.$store.state.svnProjects.filter((e=>e.slug===t));if(0===e.length)throw console.log("no such project"),Error;return e[0]}async loadDataset(){try{const t=await this.myDataManager.getDataset(this.vizDetails);console.log("dataset:",t);const e=t.allRows||{};console.log("data:",e);const n=e.origin.values,o=e.destination.values,a=e.count.values;console.log("in loadDataset");const i=[];for(let s=0;s<n.length;s++)i.push({o:`${n[s]}`,d:`${o[s]}`,v:a[s]});this.flows=i}catch(t){const e=""+t;console.log(e),this.flows=[]}console.log({flows:this.flows})}updateChart(){}};Na([Ee({required:!1})],Ra.prototype,"fsConfig",2),Na([Ee({required:!0})],Ra.prototype,"root",2),Na([Ee({required:!1})],Ra.prototype,"configFromDashboard",2),Na([Ee({required:!1})],Ra.prototype,"thumbnail",2),Na([Ee({required:!0})],Ra.prototype,"subfolder",2),Na([Ee({required:!1})],Ra.prototype,"files",2),Na([Ee({required:!1})],Ra.prototype,"yamlConfig",2),Na([Ee({required:!1})],Ra.prototype,"datamanager",2),Na([function(t,e){void 0===e&&(e={});var n=e.deep,o=void 0!==n&&n,a=e.immediate,i=void 0!==a&&a;return Ce((function(e,n){"object"!=typeof e.watch&&(e.watch=Object.create(null));var a=e.watch;"object"!=typeof a[t]||Array.isArray(a[t])?void 0===a[t]&&(a[t]=[]):a[t]=[a[t]],a[t].push({handler:n,deep:o,immediate:i})}))}("$store.state.viewState")],Ra.prototype,"viewMoved",1),Ra=Na([Oe({components:{FlowMapLayer:function({props:t={},viewId:e=0}){const{locations:n,flows:o,dark:s,elapsed:r,vizDetails:c}=t,[f,g]=a.exports.useState(l.state.viewState),[h,m]=a.exports.useState({});d[e]=()=>{g(l.state.viewState)};const v=new Pa({data:t,id:"my-flowmap-"+e,getLocationId:t=>t.id,getLocationLat:t=>t.lat,getLocationLon:t=>t.lon,getLocationName:t=>t.id,getFlowOriginId:t=>t.o,getFlowDestId:t=>t.d,getFlowMagnitude:t=>t.v||null,adaptiveScalesEnabled:!0,animationEnabled:c.animationEnabled,clusteringEnabled:c.clustering,clusteringAuto:c.clustering,clusteringLevel:c.clusteringLevel,colorScheme:c.colorScheme,darkMode:s,drawOutline:!1,fadeEnabled:!0,fadeAmount:20,fadeOpacityEnabled:!0,locationLabelsEnabled:c.locationLabelsEnabled,locationTotalsEnabled:c.locationTotalsEnabled,onHover:function(t){console.log(t),m(t)},opacity:1,outlineThickness:c.outlineThickness,pickable:!0});return i.createElement(b,{layers:[v],controller:!0,viewState:f,pickingRadius:4,getCursor:()=>"pointer",onClick:function(){console.log("click!")},onViewStateChange:t=>{return e=t.viewState,g(e),e.center=[e.longitude,e.latitude],void l.commit("setMapCamera",e);var e}},i.createElement(p,{mapStyle:l.getters.mapStyle,mapboxApiAccessToken:u}))},VizConfigurator:c,ZoomButtons:f}})],Ra);const Ba={};var Ga=g(Ra,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flowmap",class:{"hide-thumbnail":!t.thumbnail},style:{background:t.urlThumbnail},attrs:{oncontextmenu:"return false"}},[n("div",{staticClass:"map-layout"},[t.centroids.length?n("flow-map-layer",{staticClass:"map-layer",attrs:{viewId:t.viewId,props:t.mapProps}}):t._e()],1),!t.vizDetails.title||t.thumbnail||t.configFromDashboard?t._e():n("div",{staticClass:"title-panel"},[n("h3",[t._v(t._s(t.vizDetails.title))]),n("p",[t._v(t._s(t.vizDetails.description))])]),t.thumbnail?t._e():n("zoom-buttons"),t.thumbnail?t._e():n("div",{staticClass:"bottom-panel"},[n("b-checkbox",{staticClass:"hello",model:{value:t.vizDetails.animationEnabled,callback:function(e){t.$set(t.vizDetails,"animationEnabled",e)},expression:"vizDetails.animationEnabled"}}),n("p",[t._v("Animation")]),n("b-checkbox",{staticClass:"hello",model:{value:t.vizDetails.locationLabelsEnabled,callback:function(e){t.$set(t.vizDetails,"locationLabelsEnabled",e)},expression:"vizDetails.locationLabelsEnabled"}}),n("p",[t._v("Labels")]),n("b-checkbox",{staticClass:"hello",model:{value:t.vizDetails.clustering,callback:function(e){t.$set(t.vizDetails,"clustering",e)},expression:"vizDetails.clustering"}}),n("p",[t._v("Clustering")])],1)],1)}),[],!1,Ua,"41dc21b0",null,null);function Ua(t){for(let e in Ba)this[e]=Ba[e]}var $a=function(){return Ga.exports}(),Ya=Object.freeze(Object.defineProperty({__proto__:null,default:$a},Symbol.toStringTag,{value:"Module"}));export{Oe as C,$a as F,Ee as P,Ya as a};
//# sourceMappingURL=Flowmap.08181ab3.js.map
