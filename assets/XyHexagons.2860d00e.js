var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,r=(e,t)=>{for(var i in t||(t={}))n.call(t,i)&&a(e,i,t[i]);if(s)for(var i of s(t))o.call(t,i)&&a(e,i,t[i]);return e},l=(e,s)=>t(e,i(s));import{r as c,R as g,d as u}from"./vendor.e9c367ae.js";import{V as h}from"./vue-slider-component.umd.min.efc39df5.js";import{d}from"./index.e02ae17f.js";import{b as p}from"./index.3d2ad359.js";import{u as m}from"./util.b5d45f97.js";import{R as f,g as v,M as y,C as S,S as b,n as x}from"./index.2deacc07.js";import{H as C}from"./HTTPFileSystem.e57ad358.js";import{C as D}from"./CollapsiblePanel.58a8eae6.js";import{m as w,W as A,p as M,g as z,D as _}from"./DrawingTool.daac4c85.js";import{Z as P}from"./ZoomButtons.e860a156.js";import{D as k,S as T}from"./deckgl.61194435.js";import{c as L}from"./index.7080a99e.js";import{A as j}from"./arc-layer.bf091b3d.js";import{G as E,ab as F,l as I,a as R,$ as H,ac as O,Y as $,b as U,c as V,M as B,U as N,_ as W,ad as G,ae as q,af as Y,W as Z}from"./layer.b20bd88e.js";import{C as X}from"./text-layer.f1b6c0de.js";import"./path-layer.f17fbd6c.js";import"./extends.f4cf4404.js";class K extends E{constructor(e){const{id:t=F("column-geometry")}=e,{indices:i,attributes:s}=function(e){const{radius:t,height:i=1,nradial:s=10}=e;let{vertices:n}=e;n&&(I.assert(n.length>=s),n=n.flatMap((e=>[e[0],e[1]])),w(n,A.COUNTER_CLOCKWISE));const o=i>0,a=s+1,r=o?3*a+1:s,l=2*Math.PI/s,c=new Uint16Array(o?3*s*2:0),g=new Float32Array(3*r),u=new Float32Array(3*r);let h=0;if(o){for(let e=0;e<a;e++){const o=e*l,a=e%s,r=Math.sin(o),c=Math.cos(o);for(let e=0;e<2;e++)g[h+0]=n?n[2*a]:c*t,g[h+1]=n?n[2*a+1]:r*t,g[h+2]=(.5-e)*i,u[h+0]=n?n[2*a]:c,u[h+1]=n?n[2*a+1]:r,h+=3}g[h+0]=g[h-3],g[h+1]=g[h-2],g[h+2]=g[h-1],h+=3}for(let d=o?0:1;d<a;d++){const e=Math.floor(d/2)*Math.sign(.5-d%2),o=e*l,a=(e+s)%s,r=Math.sin(o),c=Math.cos(o);g[h+0]=n?n[2*a]:c*t,g[h+1]=n?n[2*a+1]:r*t,g[h+2]=i/2,u[h+2]=1,h+=3}if(o){let e=0;for(let t=0;t<s;t++)c[e++]=2*t+0,c[e++]=2*t+2,c[e++]=2*t+0,c[e++]=2*t+1,c[e++]=2*t+1,c[e++]=2*t+3}return{indices:c,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:u}}}}(e);super(l(r({},e),{id:t,indices:i,attributes:s}))}}const J=[0,0,0,255],Q={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:J},getLineColor:{type:"accessor",value:J},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ee extends R{getShaders(){const{gl:e}=this.context,t=!H(e),i={},s=this.props.flatShading&&O(e,$.GLSL_DERIVATIVES);return s&&(i.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n\n#define SHADER_NAME column-layer-vertex-shader\n\nin vec3 positions;\nin vec3 normals;\n\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\n\nin vec3 instancePickingColors;\n\n// Custom uniforms\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool stroked;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int radiusUnits;\nuniform int widthUnits;\n\n// Result\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec4 position_commonspace;\n#endif\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  // rotate primitive position and normal\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n\n  // calculate elevation, if 3d not enabled set to 0\n  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1\n  float elevation = 0.0;\n  // calculate stroke offset\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (stroked) {\n    float widthPixels = clamp(\n      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n    if (isStroke) {\n      strokeOffsetRatio -= sign(positions.z) * halfOffset;\n    } else {\n      strokeOffsetRatio -= halfOffset;\n    }\n  }\n\n  // if alpha == 0.0 or z < 0.0, do not render element\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.pickingColor = instancePickingColors;\n\n  // project center of column\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;\n  if (radiusUnits == UNIT_METERS) {\n    offset = project_size(offset);\n  }\n  vec3 pos = vec3(offset, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Light calculations\n  if (extruded && !isStroke) {\n#ifdef FLAT_SHADING\n    position_commonspace = geometry.position;\n    vColor = vec4(color.rgb, color.a * opacity);\n#else\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n#endif\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nuniform vec3 project_uCameraPosition;\nuniform bool extruded;\nuniform bool isStroke;\n\nout vec4 fragColor;\n\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec4 position_commonspace;\n#endif\n\nvoid main(void) {\n  fragColor = vColor;\n#ifdef FLAT_SHADING\n  if (extruded && !isStroke && !picking_uActive) {\n    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n  }\n#endif\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:i,transpileToGLSL100:t,modules:[U,s?M:z,V]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:J},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:J},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,n=s.extensionsChanged||t.flatShading!==i.flatShading;if(n){var o;const{gl:e}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}(n||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){const s=new K({radius:1,height:i?2:0,vertices:t,nradial:e});let n=0;if(t)for(let o=0;o<e;o++){const i=t[o];n+=Math.sqrt(i[0]*i[0]+i[1]*i[1])/e}else n=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*n}),s}_getModel(e){return new B(e,l(r({},this.getShaders()),{id:this.props.id,isInstanced:!0}))}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:s}){const n=this.getGeometry(e,t,i||s);this.setState({fillVertexCount:n.attributes.POSITION.value.length/3,wireframeVertexCount:n.indices.value.length}),this.state.model.setProps({geometry:n})}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:i,lineWidthMinPixels:s,lineWidthMaxPixels:n,radiusUnits:o,elevationScale:a,extruded:r,filled:l,stroked:c,wireframe:g,offset:u,coverage:h,radius:d,angle:p}=this.props,{model:m,fillVertexCount:f,wireframeVertexCount:v,edgeDistance:y}=this.state;m.setUniforms(e).setUniforms({radius:d,angle:p/180*Math.PI,offset:u,extruded:r,stroked:c,coverage:h,elevationScale:a,edgeDistance:y,radiusUnits:N[o],widthUnits:N[t],widthScale:i,widthMinPixels:s,widthMaxPixels:n}),r&&g&&(m.setProps({isIndexed:!0}),m.setVertexCount(v).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(m.setProps({isIndexed:!1}),m.setVertexCount(f).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!r&&c&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*f/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}function te(){return new Worker("/simwrapper/assets/CsvGzipParser.worker.31b9981e.js",{type:"module"})}W(ee,"layerName","ColumnLayer"),W(ee,"defaultProps",Q);const ie={SUM:1,MEAN:2,MIN:3,MAX:4};function se(e,t){return e+t}function ne(e,t){return t>e?t:e}function oe(e,t){return t<e?t:e}function ae(e,t,i){const s=ie[e]||ie.SUM;switch(t=function(e,t={}){if(Number.isFinite(e))return e;return i=>(t.index=i.index,e(i.source,t))}(t,i),s){case ie.MIN:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(oe,1/0):null}(e,t);case ie.SUM:return e=>function(e,t){if(Number.isFinite(t))return e.length?e.length*t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(se,0):null}(e,t);case ie.MEAN:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(se,0)/i.length:null}(e,t);case ie.MAX:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;const i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(ne,-1/0):null}(e,t);default:return null}}function re(e,t={}){return i=>(t.indices=i.map((e=>e.index)),e(i.map((e=>e.source)),t))}function le(e,t){const i={};for(const s in e)t.includes(s)||(i[s]=e[s]);return i}class ce extends X{constructor(...e){super(...e),W(this,"state",void 0)}initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:le(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const e=this.getShaders({});e&&e.defines&&(e.defines.NON_INSTANCED_MODEL=1),this.updateShaders(e)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,gl:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,pickingActive:0,devicePixelRatio:G(i)})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:s,changeFlags:n}=e,{compareAll:o=!1,dimension:a}=t,{ignoreProps:r}=this.state,{props:l,accessors:c=[]}=a,{updateTriggersChanged:g}=n;if(n.dataChanged)return!0;if(g){if(g.all)return!0;for(const e of c)if(g[e])return!0}if(o)return!!n.extensionsChanged||q({oldProps:s,newProps:i,ignoreProps:r,propTypes:this.constructor._propTypes});for(const u of l)if(i[u]!==s[u])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&void 0!==t[e]:!function(e){let t=!0;for(const i in e){t=!1;break}return t}(t)}_getAttributeManager(){return new Y(this.context.gl,{id:this.props.id,stats:this.context.stats})}}function ge(e,t,i){const s=i;return s.domain=()=>e,s.range=()=>t,s}function ue(e,t){return ge(e,t,(i=>function(e,t,i){const s=e[1]-e[0];if(s<=0)return I.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];const n=s/t.length,o=Math.floor((i-e[0])/n),a=Math.max(Math.min(o,t.length-1),0);return t[a]}(e,t,i)))}function he(e,t){return ge(e,t,(i=>function(e,t,i){return(i-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}(e,t,i)))}function de(e,t){const i=e.sort(pe);let s=0;const n=Math.max(1,t.length),o=new Array(n-1);for(;++s<n;)o[s-1]=me(i,s/n);const a=e=>function(e,t,i){return t[function(e,t){let i=0,s=e.length;for(;i<s;){const n=i+s>>>1;pe(e[n],t)>0?s=n:i=n+1}return i}(e,i)]}(o,t,e);return a.thresholds=()=>o,ge(e,t,a)}function pe(e,t){return e-t}function me(e,t){const i=e.length;if(t<=0||i<2)return e[0];if(t>=1)return e[i-1];const s=(i-1)*t,n=Math.floor(s),o=e[n];return o+(e[n+1]-o)*(s-n)}function fe(e,t){const i=new Map,s=[];for(const n of e){const e="".concat(n);i.has(e)||i.set(e,s.push(n))}return ge(e,t,(e=>function(e,t,i,s){const n="".concat(s);let o=t.get(n);return void 0===o&&(o=e.push(s),t.set(n,o)),i[(o-1)%i.length]}(s,i,t,e)))}function ve(e){return null!=e}function ye(e,t){return("function"==typeof t?e.map(t):e).filter(ve)}function Se(e,t){return function(e){const t=[];return e.forEach((e=>{!t.includes(e)&&ve(e)&&t.push(e)})),t}(ye(e,t))}W(ce,"layerName","AggregationLayer");const be=e=>e.length,xe=e=>e.points,Ce=e=>e.index,De=(e,t)=>e<t?-1:e>t?1:e>=t?0:NaN,we={getValue:be,getPoints:xe,getIndex:Ce,filterData:null};class Ae{constructor(e=[],t=we){W(this,"maxCount",void 0),W(this,"maxValue",void 0),W(this,"minValue",void 0),W(this,"totalCount",void 0),W(this,"aggregatedBins",void 0),W(this,"sortedBins",void 0),W(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(e,t),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,t){const{getValue:i=be,getPoints:s=xe,getIndex:n=Ce,filterData:o}=t,a="function"==typeof o,r=e.length,l=[];let c=0;for(let g=0;g<r;g++){const t=e[g],r=s(t),u=n(t),h=a?r.filter(o):r;t.filteredPoints=a?h:null;const d=h.length?i(h):null;null!=d&&(l[c]={i:Number.isFinite(u)?u:g,value:d,counts:h.length},c++)}return l}_percentileToIndex(e){const t=this.sortedBins.length;if(t<2)return[0,0];const[i,s]=e.map((e=>{return t=e,i=0,s=100,Math.max(i,Math.min(s,t));var t,i,s}));return[Math.ceil(i/100*(t-1)),Math.floor(s/100*(t-1))]}getBinMap(){const e={};for(const t of this.aggregatedBins)e[t.i]=t;return e}_updateMinMaxValues(){let e=0,t=0,i=3402823466e29,s=0;for(const n of this.aggregatedBins)e=e>n.counts?e:n.counts,t=t>n.value?t:n.value,i=i<n.value?i:n.value,s+=n.counts;this.maxCount=e,this.maxValue=t,this.minValue=i,this.totalCount=s}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((e,t)=>De(e.value,t.value)))),!this.sortedBins.length)return[];let t=0,i=this.sortedBins.length-1;if(Array.isArray(e)){const s=this._percentileToIndex(e);t=s[0],i=s[1]}return[this.sortedBins[t].value,this.sortedBins[i].value]}getValueDomainByScale(e,[t=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((e,t)=>De(e.value,t.value)))),!this.sortedBins.length)return[];const s=this._percentileToIndex([t,i]);return this._getScaleDomain(e,s)}_getScaleDomain(e,[t,i]){const s=this.sortedBins;switch(e){case"quantize":case"linear":return[s[t].value,s[i].value];case"quantile":return ye(s.slice(t,i+1),(e=>e.value));case"ordinal":return Se(s,(e=>e.value));default:return[s[t].value,s[i].value]}}}function Me(){}const ze=["getBins","getDomain","getScaleFunc"],_e=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],Pe=e=>e.cellSize;class ke{constructor(e){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||Pe,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||_e)}static defaultDimensions(){return _e}updateState(e,t){const{oldProps:i,props:s,changeFlags:n}=e;this.updateGetValueFuncs(i,s,n);const o=this.needsReProjectPoints(i,s,n);let a=!1;if(n.dataChanged||o)this.getAggregatedData(s,t),a=!0;else{(this.getDimensionChanges(i,s,n)||[]).forEach((e=>"function"==typeof e&&e())),a=!0}return this.setState({aggregationDirty:a}),this.state}setState(e){this.state=r(r({},this.state),e)}setDimensionState(e,t){this.setState({dimensions:l(r({},this.state.dimensions),{[e]:r(r({},this.state.dimensions[e]),t)})})}normalizeResult(e={}){return e.hexagons?r({data:e.hexagons},e):e.layerData?r({data:e.layerData},e):e}getAggregatedData(e,t){const i=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,t,i){for(const s in this.dimensionUpdaters){const{value:n,weight:o,aggregation:a}=this.dimensionUpdaters[s].getBins.triggers;let r=t[n.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[s].getBins,e,t,i)&&(r=r?re(r,{data:t.data}):ae(t[a.prop],t[o.prop],{data:t.data})),r&&this.setDimensionState(s,{getValue:r})}}needsReProjectPoints(e,t,i){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach((e=>{const{key:t}=e;this.dimensionUpdaters[t]=this.getDimensionUpdaters(e),this.state.dimensions[t]={getValue:null,domain:null,sortedBins:null,scaleFunc:Me}}))}getDimensionUpdaters({key:e,accessor:t,pickingInfo:i,getBins:s,getDomain:n,getScaleFunc:o,nullValue:a}){return{key:e,accessor:t,pickingInfo:i,getBins:r({updater:this.getDimensionSortedBins},s),getDomain:r({updater:this.getDimensionValueDomain},n),getScaleFunc:r({updater:this.getDimensionScale},o),attributeAccessor:this.getSubLayerDimensionAttribute(e,a)}}needUpdateDimensionStep(e,t,i,s){return Object.values(e.triggers).some((e=>e.updateTrigger?s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged[e.updateTrigger]):t[e.prop]!==i[e.prop]))}getDimensionChanges(e,t,i){const s=[];for(const n in this.dimensionUpdaters){const o=ze.find((s=>this.needUpdateDimensionStep(this.dimensionUpdaters[n][s],e,t,i)));o&&s.push(this.dimensionUpdaters[n][o].updater.bind(this,t,this.dimensionUpdaters[n]))}return s.length?s:null}getUpdateTriggers(e){const t=e.updateTriggers||{},i={};for(const s in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[s];i[n]={},ze.forEach((o=>{Object.values(this.dimensionUpdaters[s][o].triggers).forEach((({prop:s,updateTrigger:o})=>{if(o){const e=t[o];"object"!=typeof e||Array.isArray(e)?void 0!==e&&(i[n][s]=e):Object.assign(i[n],e)}else i[n][s]=e[s]}))}))}return i}getSortedBins(e){for(const t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}getDimensionSortedBins(e,t){const{key:i}=t,{getValue:s}=this.state.dimensions[i],n=new Ae(this.state.layerData.data||[],{getValue:s,filterData:e._filterData});this.setDimensionState(i,{sortedBins:n}),this.getDimensionValueDomain(e,t)}getDimensionValueDomain(e,t){const{getDomain:i,key:s}=t,{triggers:{lowerPercentile:n,upperPercentile:o,scaleType:a}}=i,r=this.state.dimensions[s].sortedBins.getValueDomainByScale(e[a.prop],[e[n.prop],e[o.prop]]);this.setDimensionState(s,{valueDomain:r}),this.getDimensionScale(e,t)}getDimensionScale(e,t){const{key:i,getScaleFunc:s,getDomain:n}=t,{domain:o,range:a}=s.triggers,{scaleType:r}=n.triggers,{onSet:l}=s,c=e[a.prop],g=e[o.prop]||this.state.dimensions[i].valueDomain,u=function(e){switch(e){case"quantize":return ue;case"linear":return he;case"quantile":return de;case"ordinal":return fe;default:return ue}}(r&&e[r.prop])(g,c);"object"==typeof l&&"function"==typeof e[l.props]&&e[l.props](u.domain()),this.setDimensionState(i,{scaleFunc:u})}getSubLayerDimensionAttribute(e,t){return i=>{const{sortedBins:s,scaleFunc:n}=this.state.dimensions[e],o=s.binMap[i.index];if(o&&0===o.counts)return t;const a=o&&o.value,r=n.domain();return a>=r[0]&&a<=r[r.length-1]?n(a):t}}getSubLayerAccessors(e){const t={};for(const i in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[i];t[s]=this.getSubLayerDimensionAttribute(e,i)}return t}getPickingInfo({info:e}){let t=null;if(e.picked&&e.index>-1){const i=this.state.layerData.data[e.index],s={};for(const e in this.dimensionUpdaters){const{pickingInfo:t}=this.dimensionUpdaters[e],{sortedBins:n}=this.state.dimensions[e],o=n.binMap[i.index]&&n.binMap[i.index].value;s[t]=o}t=Object.assign(s,i,{points:i.filteredPoints||i.points})}return e.picked=Boolean(t),e.object=t,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:Me}}var Te=Math.PI/3,Le=[0,Te,2*Te,3*Te,4*Te,5*Te];function je(e){return e[0]}function Ee(e){return e[1]}function Fe(){}const Ie={colorDomain:null,colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Fe,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Fe,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){const{data:i,radius:s}=e,{viewport:n,attributes:o}=t,a=i.length?function(e,t){const{attributes:i}=t,s=i.positions.value,{size:n}=i.positions.getAccessor();let o,a=1/0,r=1/0,l=-1/0,c=-1/0;for(o=0;o<n*e.length;o+=n){const e=s[o],t=s[o+1];Number.isFinite(e)&&Number.isFinite(t)&&(a=Math.min(e,a),l=Math.max(e,l),r=Math.min(t,r),c=Math.max(t,c))}return[a,r,l,c].every(Number.isFinite)?[(a+l)/2,(r+c)/2]:null}(i,t):null,r=function(e,t,i){const{unitsPerMeter:s}=t.getDistanceScales(i);return e*s[0]}(s,n,a),l=[],{iterable:c,objectInfo:g}=Z(i),u=o.positions.value,{size:h}=o.positions.getAccessor();for(const d of c){g.index++;const e=g.index*h,t=[u[e],u[e+1]];Number.isFinite(t[0])&&Number.isFinite(t[1])?l.push({screenCoord:n.projectFlat(t),source:d,index:g.index}):I.warn("HexagonLayer: invalid position")()}return{hexagons:function(){var e,t,i,s=0,n=0,o=1,a=1,r=je,l=Ee;function c(e){var s,n={},o=[],a=e.length;for(s=0;s<a;++s)if(!isNaN(g=+r.call(null,c=e[s],s,e))&&!isNaN(u=+l.call(null,c,s,e))){var c,g,u,h=Math.round(u/=i),d=Math.round(g=g/t-(1&h)/2),p=u-h;if(3*Math.abs(p)>1){var m=g-d,f=d+(g<d?-1:1)/2,v=h+(u<h?-1:1),y=g-f,S=u-v;m*m+p*p>y*y+S*S&&(d=f+(1&h?1:-1)/2,h=v)}var b=d+"-"+h,x=n[b];x?x.push(c):(o.push(x=n[b]=[c]),x.x=(d+(1&h)/2)*t,x.y=h*i)}return o}function g(e){var t=0,i=0;return Le.map((function(s){var n=Math.sin(s)*e,o=-Math.cos(s)*e,a=n-t,r=o-i;return t=n,i=o,[a,r]}))}return c.hexagon=function(t){return"m"+g(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var r=[],l=Math.round(n/i),c=Math.round(s/t),g=l*i;g<a+e;g+=i,++l)for(var u=c*t+(1&l)*t/2;u<o+t/2;u+=t)r.push([u,g]);return r},c.mesh=function(){var t=g(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(r=e,c):r},c.y=function(e){return arguments.length?(l=e,c):l},c.radius=function(s){return arguments.length?(t=2*(e=+s)*Math.sin(Te),i=1.5*e,c):e},c.size=function(e){return arguments.length?(s=n=0,o=+e[0],a=+e[1],c):[o-s,a-n]},c.extent=function(e){return arguments.length?(s=+e[0][0],n=+e[0][1],o=+e[1][0],a=+e[1][1],c):[[s,n],[o,a]]},c.radius(1)}().radius(r).x((e=>e.screenCoord[0])).y((e=>e.screenCoord[1]))(l).map(((e,t)=>({position:n.unprojectFlat([e.x,e.y]),points:e,index:t}))),radiusCommon:r}},getPosition:{type:"accessor",value:e=>e.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class Re extends ce{constructor(...e){super(...e),W(this,"state",void 0)}initializeState(){const e=new ke({getAggregator:e=>e.hexagonAggregator,getCellSize:e=>e.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null};this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){const t=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==t.layerData){const{hexagonVertices:e}=t.layerData||{};this.setState({vertices:e&&this.convertLatLngToMeterOffset(e)})}this.setState({aggregatorState:t})}}convertLatLngToMeterOffset(e){const{viewport:t}=this.context;if(Array.isArray(e)&&6===e.length){const i=e[0],s=e[3],n=[(i[0]+s[0])/2,(i[1]+s[1])/2],o=t.projectFlat(n),{metersPerUnit:a}=t.getDistanceScales(n);return e.map((e=>{const i=t.projectFlat(e);return[(i[0]-o[0])*a[0],(i[1]-o[1])*a[1]]}))}return I.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,coverage:i,material:s,transitions:n}=this.props,{aggregatorState:o,vertices:a}=this.state,c=this.getSubLayerClass("hexagon-cell",ee),g=this._getSublayerUpdateTriggers(),u=a?{vertices:a,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90};return new c(l(r({},u),{diskResolution:6,elevationScale:e,extruded:t,coverage:i,material:s,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:n&&{getFillColor:n.getColorValue||n.getColorWeight,getElevation:n.getElevationValue||n.getElevationWeight}}),this.getSubLayerProps({id:"hexagon-cell",updateTriggers:g}),{data:o.layerData.data})}}W(Re,"layerName","HexagonLayer"),W(Re,"defaultProps",Ie);const He={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},Oe={zoom:10,longitude:13.45,latitude:52.5,pitch:0,bearing:0};const $e=u({name:"XyHexagonsPlugin",i18n:{messages:{en:{loading:"Loading data...",sorting:"Sorting into bins...",aggregate:"Summary",maxHeight:"3D Height",showDetails:"Show Details",selection:"Selection",areas:"Areas",count:"Count"},de:{loading:"Dateien laden...",sorting:"Sortieren...",aggregate:"Daten",maxHeight:"3-D Höhe",showDetails:"Details anzeigen",selection:"Ausgewählt",areas:"Orte",count:"Anzahl"}}},components:{CollapsiblePanel:D,DrawingTool:_,XyHexDeckMap:function({viewId:e=0,colorRamp:t="chlorophyll",coverage:i=.65,dark:s=!1,data:n={raw:new Float32Array(0),length:0},extrude:o=!0,highlights:a=[],mapIsIndependent:r=!1,maxHeight:l=200,metric:u="Count",radius:h=100,selectedHexStats:d={rows:0,numHexagons:0,selectedHexagonIds:[]},upperPercentile:p=100,onClick:m={}}){const[S,b]=c.exports.useState(Oe);f[e]=e=>{b(e||v.state.viewState)};const x=L({colormap:t,nshades:10,format:"rba",alpha:1}).map((e=>[e[0],e[1],e[2]]));let C=null;C=a.length?a.map((e=>e[1])):n.length?{length:n.length,attributes:{getPosition:{value:n.raw,size:2}}}:null;const D=[new j({id:"arc-layer",data:a,getSourcePosition:e=>e[0],getTargetPosition:e=>e[1],pickable:!1,opacity:.4,getHeight:0,getWidth:1,getSourceColor:s?[144,96,128]:[192,192,240],getTargetColor:s?[144,96,128]:[192,192,240]}),new Re({id:"hexlayer",data:C,getPosition:a.length?e=>e:null,colorRange:s?x.slice(1):x.reverse().slice(1),coverage:i,autoHighlight:!0,elevationRange:[0,l],elevationScale:n&&n.length?50:0,extruded:o,selectedHexStats:d,pickable:!0,opacity:.7,radius:h,upperPercentile:p,material:He,transitions:{elevationScale:{type:"interpolation",duration:1e3},opacity:{type:"interpolation",duration:200}}})];return g.createElement(k,{layers:D,controller:!0,useDevicePixels:!1,viewState:S,getTooltip:function({object:e}){if(!e||!e.position||!e.position.length)return null;const t=e.position[1],i=e.position[0],n=e.points.length;return{html:`        <b>${a.length?"Count":u}: ${n} </b><br/>\n        ${Number.isFinite(t)?t.toFixed(4):""} / ${Number.isFinite(i)?i.toFixed(4):""}\n      `,style:s?{color:"#ccc",backgroundColor:"#2a3c4f"}:{color:"#223",backgroundColor:"white"}}},onClick:function(e,t){m(e,t)},onViewStateChange:e=>{var t;(t=e.viewState).latitude&&(t.center||(t.center=[0,0]),t.center[0]=t.longitude,t.center[1]=t.latitude,b(t),r||v.commit("setMapCamera",t))}},g.createElement(T,{mapStyle:v.getters.mapStyle,preventStyleDiffing:!0,mapboxApiAccessToken:y}))},VueSlider:h,ToggleButton:d.exports.ToggleButton,ZoomButtons:P},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>{const e=["bathymetry","par","chlorophyll","magma"];return{id:`id-${Math.floor(1e12*Math.random())}`,standaloneYAMLconfig:{title:"",description:"",file:"",projection:"",thumbnail:"",aggregations:{},radius:250,maxHeight:0,center:null,zoom:9,mapIsIndependent:!1},YAMLrequirementsXY:{file:"",aggregations:{}},colorRamps:e,buttonColors:["#5E8AAE","#BF7230","#269367","#9C439C"],aggregations:{},columnLookup:[],gzipWorker:null,colorRamp:e[0],globalState:v.state,vizDetails:{title:"",description:"",file:"",projection:"",thumbnail:"",aggregations:{},radius:250,maxHeight:0,center:null,zoom:9},myState:{statusMessage:"",subfolder:"",yamlConfig:"",thumbnail:!1},rowCache:{},requests:{raw:new Float32Array(0),length:0},highlightedTrips:[],searchTerm:"",searchEnabled:!1,isLoaded:!1,activeAggregation:"",isHighlightingZone:!1,multiSelectedHexagons:{},thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",hexStats:null,resizer:null}},computed:{fileApi(){return new C(this.fileSystem,v)},fileSystem(){const e=this.$store.state.svnProjects.filter((e=>e.slug===this.root));if(0===e.length)throw console.log("no such project"),Error;return e[0]},urlThumbnail(){return this.thumbnailUrl},buttonLabel(){const[e,t]=this.activeAggregation.split("~");return this.aggregations[e][t].title},extrudeTowers(){return this.vizDetails.maxHeight>0},mapProps(){return{viewId:this.id,colorRamp:this.colorRamp,coverage:.65,dark:this.$store.state.isDarkMode,data:this.requests,extrude:this.extrudeTowers,highlights:this.highlightedTrips,mapIsIndependent:this.vizDetails.mapIsIndependent,maxHeight:this.vizDetails.maxHeight,metric:this.buttonLabel,radius:this.vizDetails.radius,selectedHexStats:this.hexStats,upperPercentile:100,onClick:this.handleClick}},textColor(){return this.$store.state.colorScheme===S.DarkMode?{text:"white",bg:"#181518aa"}:{text:"#3498db",bg:"#eeeef480"}}},watch:{extrudeTowers(){this.extrudeTowers&&0==this.globalState.viewState.pitch&&v.commit("setMapCamera",Object.assign({},this.globalState.viewState,{pitch:10}))},"$store.state.viewState"(){this.vizDetails.mapIsIndependent||f[this.id]&&f[this.id]()}},methods:{handleClick(e,t){console.log({target:e,event:t}),e.layer?this.handleHexClick(e,t):this.handleEmptyClick()},handleEmptyClick(){this.flipViewToShowInvertedData({})},handleHexClick(e,t){var i;if(!t.srcEvent.shiftKey)return this.multiSelectedHexagons={},this.hexStats=null,void this.flipViewToShowInvertedData(e);const s=null==(i=null==e?void 0:e.object)?void 0:i.index;void 0!==s&&(s in this.multiSelectedHexagons?delete this.multiSelectedHexagons[s]:this.multiSelectedHexagons[s]=e.object.points,this.hexStats=this.selectedHexagonStatistics())},flipViewToShowInvertedData(e){this.isHighlightingZone?this.isHighlightingZone=!1:e.object?this.isHighlightingZone=!0:this.isHighlightingZone=!1;const t=this.activeAggregation.split("~");let i=0,s=0;if(this.isHighlightingZone){i=parseInt(t[1]),s=i%2?i-1:i+1;const n=`${t[0]}${i}`,o=this.rowCache[n],a=`${t[0]}${s}`,r=this.rowCache[a],l=[];for(const t of e.object.points){const e=2*t.index,i=[r.raw[e],r.raw[e+1]];l.push([[o.raw[e],o.raw[e+1]],i]),this.highlightedTrips=l}this.hexStats&&(this.hexStats.selectedHexagonIds=[]),this.multiSelectedHexagons={},this.colorRamp=this.colorRamps[s]}else this.hexStats=null,this.multiSelectedHexagons={},this.handleOrigDest(t[0],parseInt(t[1]));this.isHighlightingZone||(this.highlightedTrips=[])},async handleOrigDest(e,t){const i=e+t;this.hexStats=null,this.multiSelectedHexagons={},this.highlightedTrips=[],this.activeAggregation=`${e}~${t}`,this.requests=this.rowCache[i],this.colorRamp=this.colorRamps[t]},async solveProjection(){if(!this.thumbnail){console.log("WHAT PROJECTION:");try{const e=await this.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);this.vizDetails=p.parse(e)}catch(e){console.error(e)}}},async getVizDetails(){if(this.config)return this.validateYAML(),this.vizDetails=Object.assign({},this.config),void this.setRadiusAndHeight();new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?await this.loadStandaloneYAMLConfig():this.loadOutputTripsConfig()},loadOutputTripsConfig(){let e="EPSG:31468";this.myState.thumbnail||(e=prompt('Enter projection: e.g. "EPSG:31468"')||"EPSG:31468",parseInt(e,10)&&(e="EPSG:"+e)),this.vizDetails={title:"Output Trips",description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:e,aggregations:{"Trip Summary":[{title:"Origins",x:"start_x",y:"start_y"},{title:"Destinations",x:"end_x",y:"end_y"}]},radius:this.vizDetails.radius,maxHeight:this.vizDetails.maxHeight,center:this.vizDetails.center,zoom:this.vizDetails.zoom},this.$emit("title",this.vizDetails.title)},setRadiusAndHeight(){this.vizDetails.radius||(this.vizDetails.radius=250),this.vizDetails.maxHeight||(this.vizDetails.maxHeight=0)},async loadStandaloneYAMLConfig(){try{const e=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,t=await this.fileApi.getFileText(e);this.standaloneYAMLconfig=Object.assign({},p.parse(t)),this.validateYAML(),this.setVizDetails()}catch(e){console.log("failed"),this.$store.commit("setStatus",{type:b.ERROR,msg:"File not found",desc:`Could not find: ${this.myState.subfolder}/${this.myState.yamlConfig}`})}},validateYAML(){console.log("in yaml validation 2");let e={};new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?(console.log("has yaml"),e=this.standaloneYAMLconfig):(console.log("no yaml"),e=this.config);for(const t in this.YAMLrequirementsXY)t in e||this.$store.commit("setStatus",{type:b.ERROR,msg:`${this.yamlConfig}: missing required key: ${t}`,desc:"Check this.YAMLrequirementsXY for required keys"});0==e.radius&&this.$store.commit("setStatus",{type:b.WARNING,msg:"Radius set to zero",desc:"Radius can not be zero, preset value used instead. "}),(e.zoom<5||e.zoom>20)&&this.$store.commit("setStatus",{type:b.WARNING,msg:"Zoom is out of the recommended range ",desc:"Zoom levels should be between 5 and 20. "})},setVizDetails(){this.vizDetails=Object.assign({},this.vizDetails,this.standaloneYAMLconfig),this.setRadiusAndHeight();const e=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation";this.$emit("title",e)},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const e=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),t=await e.arrayBuffer(),i=m.arrayBufferToBase64(t);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(e){console.error(e)}},handleShowSelectionButton(){const e=Object.values(this.multiSelectedHexagons);let t=[];e.map((e=>t=t.concat(e)));const i={object:{points:t}};this.flipViewToShowInvertedData(i)},selectedHexagonStatistics(){const e=Object.keys(this.multiSelectedHexagons).map((e=>parseInt(e)));if(!e.length)return null;return{rows:Object.values(this.multiSelectedHexagons).reduce(((e,t)=>e+t.length),0),numHexagons:e.length,selectedHexagonIds:e}},async setMapCenter(){const e=Object.values(this.rowCache)[0].raw;if(this.vizDetails.center){"string"==typeof this.vizDetails.center&&(this.vizDetails.center=this.vizDetails.center.split(",").map(Number));const e={longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],bearing:0,pitch:0,zoom:this.vizDetails.zoom||10,jump:!1};return void(f[this.id]&&f[this.id](e))}if(!e.length)return;let t=0,i=0,s=0;const n=e.length/2;for(let a=0;a<n;a+=512)i+=e[2*a],s+=e[2*a+1],t++;i/=t,s/=t;const o=this.$store.state.viewState;i&&s&&this.$store.commit("setMapCamera",{longitude:i,latitude:s,bearing:o.bearing,pitch:o.pitch,zoom:this.vizDetails.zoom||o.zoom,jump:!1})},setupLogoMover(){this.resizer=new ResizeObserver(this.moveLogo);const e=document.getElementById(`id-${this.id}`);this.resizer.observe(e)},moveLogo(){const e=document.getElementById(`id-${this.id}`),t=null==e?void 0:e.querySelector(".mapboxgl-ctrl-bottom-left");if(t){const i=e.clientWidth>640?"280px":"36px";t.style.right=i}},async parseCSVFile(e){this.myState.statusMessage="Loading file...",this.gzipWorker=new te,this.gzipWorker.onmessage=async e=>{if(e.data.status)this.myState.statusMessage=e.data.status;else if(e.data.error)this.myState.statusMessage=e.data.error,this.$store.commit("setStatus",{type:b.ERROR,msg:"Loading Error",desc:"Error loading: ${this.myState.subfolder}/${this.vizDetails.file}"});else{const{rowCache:t,columnLookup:i}=e.data;this.gzipWorker&&this.gzipWorker.terminate(),this.dataIsLoaded({rowCache:t,columnLookup:i})}},this.gzipWorker.postMessage({filepath:e,fileSystem:this.fileSystem,aggregations:this.vizDetails.aggregations,projection:this.vizDetails.projection})},dataIsLoaded({rowCache:e,columnLookup:t}){this.columnLookup=t,this.rowCache=e;const i=this.activeAggregation.replaceAll("~","");this.requests=this.rowCache[i],this.setMapCenter(),this.moveLogo(),this.myState.statusMessage=""},async loadFiles(){if(!this.fileApi)return{dataArray:[]};try{let e=`${this.myState.subfolder}/${this.vizDetails.file}`;await this.parseCSVFile(e)}catch(e){console.error(e),this.myState.statusMessage=""+e,this.$store.commit("setStatus",{type:b.ERROR,msg:"Loading/Parsing Error",desc:"Error loading/parsing: ${this.myState.subfolder}/${this.vizDetails.file}"})}}},async mounted(){this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,await this.getVizDetails(),this.thumbnail||(this.setupLogoMover(),this.myState.statusMessage=`${this.$i18n.t("loading")}`,this.aggregations=this.vizDetails.aggregations,await this.loadFiles(),this.buildThumbnail(),this.isLoaded=!0,this.handleOrigDest(Object.keys(this.aggregations)[0],0))},beforeDestroy(){f[this.id]=void 0,delete f[this.id];try{this.gzipWorker&&this.gzipWorker.terminate()}catch(e){console.warn(e)}this.$store.commit("setFullScreen",!1)}});const Ue={};var Ve=x($e,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!e.thumbnail},attrs:{oncontextmenu:"return false",id:`id-${e.id}`}},[!e.thumbnail&&e.isLoaded?i("xy-hex-deck-map",e._b({staticClass:"hex-layer"},"xy-hex-deck-map",e.mapProps,!1)):e._e(),e.thumbnail?e._e():i("zoom-buttons"),e.thumbnail?e._e():i("drawing-tool",{staticClass:"drawing-tool"}),e.isLoaded&&!e.thumbnail&&e.vizDetails.title?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{direction:"left",locked:!0}},[e.hexStats?i("div",{staticClass:"panel-items",staticStyle:{color:"#c0f"}},[i("p",{staticClass:"big",staticStyle:{"margin-top":"2rem"}},[e._v(e._s(e.$t("selection"))+":")]),i("h3",{staticStyle:{"margin-top":"-1rem"}},[e._v(e._s(e.$t("areas"))+": "+e._s(e.hexStats.numHexagons)+", "+e._s(e.$t("count"))+": "+e._s(e.hexStats.rows))]),i("button",{staticClass:"button",staticStyle:{color:"#c0f","border-color":"#c0f"},on:{click:e.handleShowSelectionButton}},[e._v(e._s(e.$t("showDetails")))])]):e._e()])],1):e._e(),!e.isLoaded||e.thumbnail||e.myState.statusMessage?e._e():i("div",{staticClass:"control-panel"},[e._l(Object.keys(e.aggregations),(function(t){return i("div",{key:t,staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v(e._s(t))]),e._l(e.aggregations[t],(function(s,n){return i("button",{key:n,staticClass:"button is-small aggregation-button",style:{"margin-bottom":"0.25rem",color:e.activeAggregation===`${t}~${n}`?"white":e.buttonColors[n],border:`1px solid ${e.buttonColors[n]}`,"border-right":`0.4rem solid ${e.buttonColors[n]}`,"border-radius":"4px","background-color":e.activeAggregation===`${t}~${n}`?e.buttonColors[n]:e.$store.state.isDarkMode?"#333":"white"},on:{click:function(i){return e.handleOrigDest(t,n)}}},[e._v(e._s(s.title))])}))],2)})),i("div",{staticClass:"panel-item right"},[i("p",{staticClass:"speed-label"},[e._v(e._s(e.$t("maxHeight"))+": "+e._s(e.vizDetails.maxHeight))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:0,max:250,interval:5,duration:0,dotSize:12,tooltip:"none"},model:{value:e.vizDetails.maxHeight,callback:function(t){e.$set(e.vizDetails,"maxHeight",t)},expression:"vizDetails.maxHeight"}}),i("p",{staticClass:"speed-label"},[e._v("Hex Radius: "+e._s(e.vizDetails.radius))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:12,tooltip:"none"},model:{value:e.vizDetails.radius,callback:function(t){e.$set(e.vizDetails,"radius",t)},expression:"vizDetails.radius"}})],1)],2),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)}),[],!1,Be,"196216b2",null,null);function Be(e){for(let t in Ue)this[t]=Ue[t]}var Ne=function(){return Ve.exports}();export{Ne as default};
//# sourceMappingURL=XyHexagons.2860d00e.js.map
