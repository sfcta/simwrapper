function n(n){return new e(n instanceof Uint8Array?n:new Uint8Array(n))}function e(n){this._array=n}function t(e){return fetch(e).then((function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(n)}))}function r(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){t(n(i.response))},i.onerror=r,i.ontimeout=r,i.open("GET",e,!0),i.send()}))}function i(n){return("function"==typeof fetch?t:r)(n)}function o(n){return"function"==typeof n.read?n:n.getReader()}e.prototype.read=function(){var n=this._array;return this._array=null,Promise.resolve(n?{done:!1,value:n}:{done:!0,value:void 0})},e.prototype.cancel=function(){return this._array=null,Promise.resolve()};var u=new Uint8Array(0);function a(n,e){if(!n.length)return e;if(!e.length)return n;var t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function s(n){return"function"==typeof n.slice?n:new c("function"==typeof n.read?n:n.getReader())}function c(n){this._source=n,this._array=u,this._index=0}function f(n){return!(n=n.trim())||isNaN(n=+n)?null:n}c.prototype.read=function(){var n=this,e=n._array.subarray(n._index);return n._source.read().then((function(t){return n._array=u,n._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:a(e,t.value)}}))},c.prototype.slice=function(n){if((n|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var r=new Uint8Array(n);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then((function(o){return o.done?(e._array=u,e._index=0,t>0?r.subarray(0,t):null):t+o.value.length>=n?(e._array=o.value,e._index=n-t,r.set(o.value.subarray(0,n-t),t),r):(r.set(o.value,t),t+=o.value.length,i())}))}()},c.prototype.cancel=function(){return this._source.cancel()};var l={B:f,C:function(n){return n.trim()||null},D:function(n){return new Date(+n.substring(0,4),n.substring(4,6)-1,+n.substring(6,8))},F:f,L:function(n){return!/^[nf]$/i.test(n)&&(!!/^[yt]$/i.test(n)||null)},M:f,N:f};function h(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function d(n,e){return(n=s(n)).slice(32).then((function(t){var r=h(t);return n.slice(r.getUint16(8,!0)-32).then((function(t){return new y(n,e,r,h(t))}))}))}function y(n,e,t,r){this._source=n,this._decode=e.decode.bind(e),this._recordLength=t.getUint16(10,!0),this._fields=[];for(var i=0;13!==r.getUint8(i);i+=32){for(var o=0;o<11&&0!==r.getUint8(i+o);++o);this._fields.push({name:this._decode(new Uint8Array(r.buffer,r.byteOffset+i,o)),type:String.fromCharCode(r.getUint8(i+11)),length:r.getUint8(i+16)})}}var g=y.prototype;function v(n){var e,t=40,r=n.getInt32(36,!0),i=new Array(r);for(e=0;e<r;++e,t+=16)i[e]=[n.getFloat64(t,!0),n.getFloat64(t+8,!0)];return{type:"MultiPoint",coordinates:i}}function p(n){return{type:"Point",coordinates:[n.getFloat64(4,!0),n.getFloat64(12,!0)]}}function _(n){var e,t=44,r=n.getInt32(36,!0),i=n.getInt32(40,!0),o=new Array(r),u=new Array(i),a=[],s=[];for(e=0;e<r;++e,t+=4)o[e]=n.getInt32(t,!0);for(e=0;e<i;++e,t+=16)u[e]=[n.getFloat64(t,!0),n.getFloat64(t+8,!0)];return o.forEach((function(n,e){var t=u.slice(n,o[e+1]);!function(n){if((e=n.length)<4)return!1;var e,t=0,r=n[e-1][1]*n[0][0]-n[e-1][0]*n[0][1];for(;++t<e;)r+=n[t-1][1]*n[t][0]-n[t-1][0]*n[t][1];return r>=0}(t)?s.push(t):a.push([t])})),s.forEach((function(n){a.some((function(e){if(function(n,e){var t,r=-1,i=e.length;for(;++r<i;)if(t=b(n,e[r]))return t>0;return!1}(e[0],n))return e.push(n),!0}))||a.push([n])})),1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a}}function b(n,e){for(var t=e[0],r=e[1],i=-1,o=0,u=n.length,a=u-1;o<u;a=o++){var s=n[o],c=s[0],f=s[1],l=n[a],h=l[0],d=l[1];if(w(s,l,e))return 0;f>r!=d>r&&t<(h-c)*(r-f)/(d-f)+c&&(i=-i)}return i}function w(n,e,t){var r=t[0]-n[0],i=t[1]-n[1];if(0===r&&0===i)return!0;var o=e[0]-n[0],u=e[1]-n[1];if(0===o&&0===u)return!1;var a=(r*o+i*u)/(o*o+u*u);return!(a<0||a>1)&&(0===a||1===a||a*o===r&&a*u===i)}function x(n){var e,t=44,r=n.getInt32(36,!0),i=n.getInt32(40,!0),o=new Array(r),u=new Array(i);for(e=0;e<r;++e,t+=4)o[e]=n.getInt32(t,!0);for(e=0;e<i;++e,t+=16)u[e]=[n.getFloat64(t,!0),n.getFloat64(t+8,!0)];return 1===r?{type:"LineString",coordinates:u}:{type:"MultiLineString",coordinates:o.map((function(n,e){return u.slice(n,o[e+1])}))}}function m(n,e){var t=new Uint8Array(n.length+e.length);return t.set(n,0),t.set(e,n.length),t}g.read=function(){var n=this,e=1;return n._source.slice(n._recordLength).then((function(t){return t&&26!==t[0]?{done:!1,value:n._fields.reduce((function(r,i){return r[i.name]=l[i.type](n._decode(t.subarray(e,e+=i.length))),r}),{})}:{done:!0,value:void 0}}))},g.cancel=function(){return this._source.cancel()};var A={0:function(){return null},1:p,3:x,5:_,8:v,11:p,13:x,15:_,18:v,21:p,23:x,25:_,28:v};function F(n,e){var t=e.getInt32(32,!0);if(!(t in A))throw new Error("unsupported shape type: "+t);this._source=n,this._type=t,this._index=0,this._parse=A[t],this.bbox=[e.getFloat64(36,!0),e.getFloat64(44,!0),e.getFloat64(52,!0),e.getFloat64(60,!0)]}var U=F.prototype;function P(){}function I(n,e){this._shp=n,this._dbf=e,this.bbox=n.bbox}U.read=function(){var n=this;return++n._index,n._source.slice(12).then((function(e){if(null==e)return{done:!0,value:void 0};var t=h(e);function r(){return n._source.slice(4).then((function(o){return null==o?{done:!0,value:void 0}:(t=h(e=m(e.slice(4),o))).getInt32(0,!1)!==n._index?r():i()}))}function i(){var i=2*t.getInt32(4,!1)-4,o=t.getInt32(8,!0);return i<0||o&&o!==n._type?r():n._source.slice(i).then((function(t){return{done:!1,value:o?n._parse(h(m(e.slice(8),t))):null}}))}return i()}))},U.cancel=function(){return this._source.cancel()};var L=I.prototype;function E(e,t,r){return"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=i(t)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=n(t):null!=t&&(t=o(t)),"string"==typeof e?(/\.shp$/.test(e)||(e+=".shp"),void 0===t&&(t=i(e.substring(0,e.length-4)+".dbf").catch((function(){}))),e=i(e)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?n(e):o(e),Promise.all([e,t]).then((function(n){var e,t,i,o,u=n[0],a=n[1],c="windows-1252";return r&&null!=r.encoding&&(c=r.encoding),e=u,t=a,i=a&&new TextDecoder(c),Promise.all([(o=e,(o=s(o)).slice(100).then((function(n){return new F(o,h(n))}))),t&&d(t,i)]).then((function(n){return new I(n[0],n[1])}))}))}function M(n,e,t){return E(n,e,t).then((function(n){var e=[],t={type:"FeatureCollection",features:e,bbox:n.bbox};return n.read().then((function r(i){return i.done?t:(e.push(i.value),n.read().then(r))}))}))}L.read=function(){var n=this;return Promise.all([n._dbf?n._dbf.read():{value:{}},n._shp.read()]).then((function(n){var e=n[0],t=n[1];return t.done?t:{done:!1,value:{type:"Feature",properties:e.value,geometry:t.value}}}))},L.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(P)};export{M as r};
//# sourceMappingURL=index.028cf17b.js.map
