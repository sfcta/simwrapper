{"version":3,"file":"VideoPlayer.d20302fb.js","sources":["../../src/plugins/video-player/VideoPlayer.vue","../../src/plugins/video-player/VideoPlayer.vue?vue&type=template&lang.js"],"sourcesContent":["<template lang=\"pug\">\r\n.video-plugin-container(:class=\"{thumbnail}\")\r\n  h3(v-if=\"!thumbnail\") {{ title }}\r\n\r\n  .vid-container\r\n    video(:controls=\"controls\" :loop='loop' :allowfullscreen='allowfullscreen' :autoplay=\"autoplay\" :muted=\"muted\")\r\n      source(v-for=\"(src, type) in sources\" :src=\"src\" :type=\"type\" :key=\"type\")\r\n      p(v-for=\"(src, type) in sources\" :key=\"type\") Video tag not supported. Download the video&nbsp;\r\n        a(:href=\"src\" target=\"_blank\") here\r\n\r\n    //- video-player.vjs-default-skin.vjs-big-play-centered(\r\n    //-   ref=\"videoPlayer\"\r\n    //-   :options=\"playerOptions\"\r\n    //- )\r\n    //- v-if=\"movieSource\"\r\n\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue'\r\n\r\n// import { videoPlayer } from 'vue-video-player'\r\n\r\nimport globalStore from '@/store'\r\nimport { FileSystem, FileSystemConfig, VisualizationPlugin } from '@/Globals'\r\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\r\n\r\n// import '~/video.js/dist/video-js.min.css'\r\n\r\nconst MyComponent = defineComponent({\r\n  name: 'VideoPlayerPlugin',\r\n  props: {\r\n    root: { type: String, required: true },\r\n    subfolder: { type: String, required: true },\r\n    yamlConfig: String,\r\n    config: Object,\r\n    thumbnail: Boolean,\r\n  },\r\n\r\n  data: () => {\r\n    return {\r\n      movieSource: '',\r\n      title: '',\r\n      myState: {} as any,\r\n      fileApi: null as FileSystemConfig | null,\r\n      playerOptions: {\r\n        muted: false,\r\n        language: 'en',\r\n        playbackRates: [0.5, 1.0, 1.5, 2.0, 5.0],\r\n        preload: 'metadata',\r\n        responsive: true,\r\n        fluid: false,\r\n        playsInline: true,\r\n        controls: true,\r\n        sources: [] as any[],\r\n      },\r\n    }\r\n  },\r\n\r\n  beforeDestroy() {\r\n    if (!this.thumbnail) globalStore.commit('setFullScreen', false)\r\n  },\r\n\r\n  mounted() {\r\n    this.fileApi = this.getFileSystem(this.root)\r\n\r\n    this.myState = {\r\n      subfolder: this.subfolder,\r\n      yamlConfig: this.yamlConfig,\r\n      thumbnail: this.thumbnail,\r\n      imageData: '',\r\n    }\r\n\r\n    this.playerOptions.fluid = !!this.thumbnail\r\n    if (!this.thumbnail) globalStore.commit('setFullScreen', true)\r\n\r\n    if (!this.yamlConfig) {\r\n      this.buildRouteFromUrl()\r\n    } else {\r\n      this.myState.subfolder = this.subfolder\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.buildMovieSource()\r\n    }\r\n\r\n    this.getVizDetails()\r\n  },\r\n  watch: {\r\n    yamlConfig() {\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.getVizDetails()\r\n    },\r\n\r\n    subfolder() {\r\n      this.myState.subfolder = this.subfolder\r\n      this.getVizDetails()\r\n    },\r\n  },\r\n  methods: {\r\n    buildMovieSource() {\r\n      this.movieSource = `${this.fileApi?.baseURL}/${this.myState.subfolder}/${this.myState.yamlConfig}`\r\n\r\n      this.playerOptions.sources.push({\r\n        type: 'video/mp4',\r\n        src: this.movieSource,\r\n      })\r\n    },\r\n\r\n    getFileSystem(name: string) {\r\n      const svnProject: FileSystemConfig[] = this.$store.state.svnProjects.filter(\r\n        (a: FileSystemConfig) => a.slug === name\r\n      )\r\n      if (svnProject.length === 0) {\r\n        console.log('no such project')\r\n        throw Error\r\n      }\r\n      return svnProject[0]\r\n    },\r\n\r\n    // this happens if viz is the full page, not a thumbnail on a project page\r\n    async buildRouteFromUrl() {\r\n      const params = this.$route.params\r\n      if (!params.project || !params.pathMatch) {\r\n        console.log('I CANT EVEN: NO PROJECT/PARHMATCH')\r\n        return\r\n      }\r\n\r\n      // project filesystem\r\n      this.fileApi = this.getFileSystem(params.project)\r\n\r\n      // subfolder and config file\r\n      const sep = 1 + params.pathMatch.lastIndexOf('/')\r\n      const subfolder = params.pathMatch.substring(0, sep)\r\n      const config = params.pathMatch.substring(sep)\r\n\r\n      this.myState.subfolder = subfolder\r\n      this.myState.yamlConfig = config\r\n\r\n      this.buildMovieSource()\r\n    },\r\n\r\n    async generateBreadcrumbs() {\r\n      const filesystem = this.getFileSystem(this.$route.params.project)\r\n      if (!filesystem) return []\r\n\r\n      const crumbs = [\r\n        {\r\n          label: filesystem.name,\r\n          url: '/' + filesystem.slug,\r\n        },\r\n      ]\r\n\r\n      const subfolders = this.myState.subfolder.split('/')\r\n      let buildFolder = '/'\r\n      for (const folder of subfolders) {\r\n        if (!folder) continue\r\n\r\n        buildFolder += folder + '/'\r\n        crumbs.push({\r\n          label: folder,\r\n          url: '/' + filesystem.slug + buildFolder,\r\n        })\r\n      }\r\n\r\n      // save them!\r\n      globalStore.commit('setBreadCrumbs', crumbs)\r\n\r\n      return crumbs\r\n    },\r\n\r\n    async getVizDetails() {\r\n      this.title = this.myState.yamlConfig.replace(/_/g, ' ')\r\n      this.title = this.title.substring(0, this.title.lastIndexOf('.'))\r\n\r\n      if (this.title) {\r\n        this.$emit('title', this.title)\r\n      }\r\n    },\r\n  },\r\n})\r\n\r\nexport default MyComponent\r\n</script>\r\n\r\n<style>\r\n.video-js {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: auto;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  margin: auto 0;\r\n  background-color: #223;\r\n}\r\n</style>\r\n\r\n<style scoped lang=\"scss\">\r\n.video-plugin-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: #223;\r\n  padding: 0 20px 20px 20px;\r\n  position: relative;\r\n}\r\n\r\n.thumbnail {\r\n  height: 11rem;\r\n  // z-index: -1;\r\n  padding: 0 0;\r\n}\r\n\r\n.vid-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n\r\n.thumbnail .vid-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  overflow: hidden;\r\n}\r\n\r\nh3 {\r\n  color: #ccc;\r\n  padding: 0.5rem 0;\r\n  text-align: center;\r\n}\r\n</style>\r\n","\r\n.video-plugin-container(:class=\"{thumbnail}\")\r\n  h3(v-if=\"!thumbnail\") {{ title }}\r\n\r\n  .vid-container\r\n    video(:controls=\"controls\" :loop='loop' :allowfullscreen='allowfullscreen' :autoplay=\"autoplay\" :muted=\"muted\")\r\n      source(v-for=\"(src, type) in sources\" :src=\"src\" :type=\"type\" :key=\"type\")\r\n      p(v-for=\"(src, type) in sources\" :key=\"type\") Video tag not supported. Download the video&nbsp;\r\n        a(:href=\"src\" target=\"_blank\") here\r\n\r\n    //- video-player.vjs-default-skin.vjs-big-play-centered(\r\n    //-   ref=\"videoPlayer\"\r\n    //-   :options=\"playerOptions\"\r\n    //- )\r\n    //- v-if=\"movieSource\"\r\n\r\n"],"names":["MyComponent","defineComponent","name","props","root","type","String","required","subfolder","yamlConfig","config","Object","thumbnail","Boolean","data","movieSource","title","myState","fileApi","playerOptions","muted","language","playbackRates","preload","responsive","fluid","playsInline","controls","sources","beforeDestroy","this","globalStore","commit","mounted","getFileSystem","imageData","buildMovieSource","buildRouteFromUrl","getVizDetails","watch","methods","_a","baseURL","push","src","svnProject","$store","state","svnProjects","filter","a","slug","length","console","log","Error","params","$route","project","pathMatch","sep","lastIndexOf","substring","generateBreadcrumbs","filesystem","crumbs","label","url","subfolders","split","buildFolder","folder","replace","$emit","_vm","_h","$createElement","_c","_self","staticClass","class","_e","_v","_s","attrs","loop","allowfullscreen","autoplay","domProps","_l","key","href","target"],"mappings":"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"}