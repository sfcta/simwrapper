{"version":3,"file":"ImageView.e3de0636.js","sources":["../../src/plugins/image/ImageView.vue","../../src/plugins/image/ImageView.vue?vue&type=template&lang.js"],"sourcesContent":["<template lang=\"pug\">\r\n.image-container(v-if=\"myState.yamlConfig\" :class=\"{'zthumbnail' : thumbnail }\")\r\n  img.medium-zoom(\r\n    :src=\"myState.imageData\"\r\n    :class=\"{'invert-colors' : isDarkMode }\")\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n'use strict'\r\n\r\nimport { defineComponent } from 'vue'\r\nimport type { PropType } from 'vue'\r\n\r\n// import mediumZoom from 'medium-zoom'\r\nimport readBlob from 'read-blob'\r\n\r\nimport globalStore from '@/store'\r\nimport { ColorScheme, FileSystem, FileSystemConfig, VisualizationPlugin } from '@/Globals'\r\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\r\n\r\nconst MyComponent = defineComponent({\r\n  name: 'ImageViewPlugin',\r\n  props: {\r\n    fileApi: { type: Object as PropType<FileSystem>, required: true },\r\n    subfolder: { type: String, required: true },\r\n    yamlConfig: String,\r\n    thumbnail: Boolean,\r\n  },\r\n  data: () => {\r\n    return {\r\n      globalState: globalStore.state,\r\n      myState: {} as any,\r\n      matsimPngTitles: {\r\n        'modestats.png': 'Mode statistics',\r\n        'ph_modestats.png': 'Passenger hours traveled per mode',\r\n        'pkm_modestats.png': 'Passenger km traveled per mode',\r\n        'scorestats.png': 'Score statistics',\r\n        'stopwatch.png': 'Stopwatch: computation time',\r\n        'traveldistancestatslegs.png': 'Leg travel distance',\r\n        'traveldistancestatstrips.png': 'Trip travel distance',\r\n      } as { [id: string]: string },\r\n    }\r\n  },\r\n  computed: {\r\n    isDarkMode(): boolean {\r\n      return this.globalState.isDarkMode\r\n    },\r\n  },\r\n  methods: {\r\n    // this happens if viz is the full page, not a thumbnail on a project page\r\n    buildRouteFromUrl() {\r\n      const params = this.$route.params\r\n      if (!params.project || !params.pathMatch) {\r\n        console.log('I CANT EVEN: NO PROJECT/PARHMATCH')\r\n        return\r\n      }\r\n\r\n      // subfolder and config file\r\n      const sep = 1 + params.pathMatch.lastIndexOf('/')\r\n      const subfolder = params.pathMatch.substring(0, sep)\r\n      const config = params.pathMatch.substring(sep)\r\n\r\n      this.myState.subfolder = subfolder\r\n      this.myState.yamlConfig = config\r\n    },\r\n\r\n    async getVizDetails() {\r\n      try {\r\n        const blob = await this.myState.fileApi.getFileBlob(\r\n          this.myState.subfolder + '/' + this.myState.yamlConfig\r\n        )\r\n\r\n        if (!blob) {\r\n          console.log('no blob! :-(')\r\n          return\r\n        }\r\n\r\n        const dataUrl = await readBlob.dataurl(blob)\r\n        this.myState.imageData = dataUrl\r\n\r\n        const config = this.yamlConfig as any\r\n        const newTitle = this.matsimPngTitles[config]\r\n          ? this.matsimPngTitles[config]\r\n          : this.yamlConfig\r\n\r\n        this.$emit('title', newTitle)\r\n      } catch (e) {\r\n        console.error({ e })\r\n        return null\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    yamlConfig() {\r\n      this.myState.yamlConfig = this.yamlConfig\r\n      this.getVizDetails()\r\n    },\r\n\r\n    subfolder() {\r\n      this.myState.subfolder = this.subfolder\r\n      this.getVizDetails()\r\n    },\r\n  },\r\n  mounted() {\r\n    this.myState = {\r\n      fileApi: this.fileApi,\r\n      subfolder: this.subfolder,\r\n      yamlConfig: this.yamlConfig,\r\n      thumbnail: this.thumbnail,\r\n      imageData: '',\r\n    }\r\n\r\n    if (!this.yamlConfig) {\r\n      this.buildRouteFromUrl()\r\n    }\r\n\r\n    this.getVizDetails()\r\n  },\r\n})\r\n\r\nexport default MyComponent\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '@/styles.scss';\r\n\r\n.image-container.zthumbnail {\r\n  max-height: $thumbnailHeight;\r\n  overflow: hidden;\r\n}\r\n\r\n.medium-zoom {\r\n  padding: 0.25rem 0.25rem;\r\n}\r\n\r\n// .invert-colors {\r\n//   filter: invert(100%);\r\n// }\r\n</style>\r\n","\r\n.image-container(v-if=\"myState.yamlConfig\" :class=\"{'zthumbnail' : thumbnail }\")\r\n  img.medium-zoom(\r\n    :src=\"myState.imageData\"\r\n    :class=\"{'invert-colors' : isDarkMode }\")\r\n"],"names":["MyComponent","defineComponent","name","props","fileApi","type","Object","required","subfolder","String","yamlConfig","thumbnail","Boolean","data","globalState","globalStore","state","myState","matsimPngTitles","computed","isDarkMode","this","methods","buildRouteFromUrl","params","$route","project","pathMatch","console","log","sep","lastIndexOf","substring","config","getVizDetails","blob","getFileBlob","dataUrl","readBlob","dataurl","imageData","newTitle","$emit","e","error","watch","mounted","_vm","_h","$createElement","_c","_self","staticClass","class","zthumbnail","attrs","src","_e"],"mappings":"gIAoBA,MAAAA,EAAAC,EAAA,CACAC,KAAA,kBACAC,MAAA,CACAC,QAAA,CAAAC,KAAAC,OAAAC,UAAA,GACAC,UAAA,CAAAH,KAAAI,OAAAF,UAAA,GACAG,WAAAD,OACAE,UAAAC,SAEAC,KAAA,KACA,CACAC,YAAAC,EAAAC,MACAC,QAAA,GACAC,gBAAA,CACA,gBAAA,kBACA,mBAAA,oCACA,oBAAA,iCACA,iBAAA,mBACA,gBAAA,8BACA,8BAAA,sBACA,+BAAA,0BAIAC,SAAA,CACAC,aACA,OAAAC,KAAAP,YAAAM,aAGAE,QAAA,CAEAC,oBACA,MAAAC,EAAAH,KAAAI,OAAAD,OACA,IAAAA,EAAAE,UAAAF,EAAAG,UAEA,YADAC,QAAAC,IAAA,qCAKA,MAAAC,EAAA,EAAAN,EAAAG,UAAAI,YAAA,KACAvB,EAAAgB,EAAAG,UAAAK,UAAA,EAAAF,GACAG,EAAAT,EAAAG,UAAAK,UAAAF,GAEAT,KAAAJ,QAAAT,UAAAA,EACAa,KAAAJ,QAAAP,WAAAuB,GAAAC,sBAIA,IACA,MAAAC,QAAAd,KAAAJ,QAAAb,QAAAgC,YACAf,KAAAJ,QAAAT,UAAA,IAAAa,KAAAJ,QAAAP,YAGA,IAAAyB,EAEA,YADAP,QAAAC,IAAA,gBAIA,MAAAQ,QAAAC,EAAAC,QAAAJ,GACAd,KAAAJ,QAAAuB,UAAAH,EAEA,MAAAJ,EAAAZ,KAAAX,WACA+B,EAAApB,KAAAH,gBAAAe,GACAZ,KAAAH,gBAAAe,GACAZ,KAAAX,WAEAW,KAAAqB,MAAA,QAAAD,GAAA,MACAE,GAEA,OADAf,QAAAgB,MAAA,CAAAD,EAAAA,IACA,QAIAE,MAAA,CACAnC,aACAW,KAAAJ,QAAAP,WAAAW,KAAAX,WACAW,KAAAa,iBAGA1B,YACAa,KAAAJ,QAAAT,UAAAa,KAAAb,UACAa,KAAAa,kBAGAY,UACAzB,KAAAJ,QAAA,CACAb,QAAAiB,KAAAjB,QACAI,UAAAa,KAAAb,UACAE,WAAAW,KAAAX,WACAC,UAAAU,KAAAV,UACA6B,UAAA,IAGAnB,KAAAX,YACAW,KAAAE,oBAGAF,KAAAa,yCCpHa,WACX,IAAIa,EAAI1B,KACJ2B,EAAGD,EAAIE,eACPC,EAAGH,EAAII,MAAMD,IAAIF,EAErB,OAAOD,EAAI9B,QAAQP,WAAawC,EAAG,MAAO,CACxCE,YAAa,kBACbC,MAAO,CACLC,WAAcP,EAAIpC,YAEnB,CAACuC,EAAG,MAAO,CACZE,YAAa,cACbC,MAAO,CACL,gBAAiBN,EAAI3B,YAEvBmC,MAAO,CACLC,IAAOT,EAAI9B,QAAQuB,eAEhBO,EAAIU,OAGS"}